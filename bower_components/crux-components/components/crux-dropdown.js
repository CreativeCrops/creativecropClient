Lyte.Component.register("crux-dropdown",{_template:'<template tag-name="crux-dropdown">\t<lyte-dropdown lt-prop-position="down" style="{{cxPropStyle}}" lt-prop-show="{{cxPropShow}}" class="gBB mainCruxDropdown" lt-prop-type="multiple" lt-prop-yield="true" lt-prop-tabindex="1" on-before-hide="{{method(\'mainDropdownBeforeHide\')}}" lt-prop-remove-multiple="true" on-show="{{method(\'mainDropdownOnShow\')}}" on-hide="{{method(\'mainDropdownOnHide\')}}" on-add="{{method(\'addToList\')}}" on-remove="{{method(\'removeFromList\')}}" on-option-selected="{{method(\'mainDropdownOptionSelected\')}}">\t\t<template is="registerYield" yield-name="yield">\t\t\t<template is="if" value="{{expHandlers(cxPropType,\'==\',\'multiple\')}}"><template case="true">\t\t\t<lyte-drop-button class="cruxDropButton">\t\t\t\t<template is="if" value="{{expHandlers(newDesign,\'!\')}}"><template case="true">\t\t\t\t<template is="if" value="{{expHandlers(selectedItems.length,\'==\',0)}}"><template case="true">\t\t\t\t\t\t\t<span class="lyteMarginRight">\t\t\t\t\t\t\t{{cruxGetI18n(\'None\')}}\t\t\t\t\t\t\t</span>\t\t\t\t\t\t</template><template case="false">\t\t\t\t<template is="for" items="{{selectedItems}}" item="item" index="index">\t\t\t\t\t<span class="cruxMultiSelect" data-value="{{if(cxPropPrefixable,concat(item.prefix,\':\',item.id),item.id)}}" id="{{item.id}}">\t\t\t\t\t\t<template is="if" value="{{cxPropPrefixable}}"><template case="true"> \t\t\t\t\t\t\t{{item.prefix}}: \t\t\t\t\t\t</template></template>\t\t\t\t\t\t{{item.name}}\t\t\t\t\t\t<lyte-drop-remove class="cruxCloseIcon"></lyte-drop-remove>\t\t\t\t\t</span>\t\t\t\t</template></template></template></template><template case="false">\t\t\t\t<template is="for" items="{{cxPropOptionModels}}" item="item" index="index">\t\t\t\t\t<template is="if" value="{{expHandlers(item.selectedItems.length,\'>\',0)}}"><template case="true">\t\t\t\t\t\t<div>\t\t\t\t\t\t<div>{{item.name}}</div>\t\t\t\t\t\t\t<template is="for" items="{{item.selectedItems}}" item="select" index="index">\t\t\t\t\t\t\t<span class="cruxMultiSelect" data-value="{{if(cxPropPrefixable,concat(select.prefix,\':\',select.id),select.id)}}">\t\t\t\t\t\t\t\t<template is="if" value="{{item.imageSelector}}"><template case="true">\t\t\t\t\t\t\t\t\t<template is="if" value="{{ifEquals(select.image,\'null\')}}"><template case="true">\t\t\t\t\t\t\t\t\t <img src="/crm/CRMClient/images/nophoto.png" class="socialimg" style="height:32px;width:32px;border-radius:3px;">\t\t\t\t\t\t\t\t\t</template><template case="false">\t\t\t\t\t\t\t\t\t\t<img src="{{select.image}}" class="socialimg" style="height:32px;width:32px;border-radius:3px;">\t\t\t\t\t\t\t\t\t</template></template>\t\t\t\t\t\t\t\t</template></template>\t\t\t\t\t\t\t{{select.name}}\t\t\t\t\t\t\t\t<lyte-drop-remove class="cruxCloseIcon"></lyte-drop-remove>\t\t\t\t\t\t\t</span>\t\t\t\t\t\t\t\t\t\t\t\t</template>\t\t\t\t\t\t<div style="clear : both"></div>\t\t\t\t\t</div></template></template>\t\t\t\t</template>\t\t\t\t</template></template>\t\t\t</lyte-drop-button>\t\t\t</template><template case="false">\t\t\t\t\t\t\t\t\t\t<lyte-drop-button id="{{selectedItems[0].id}}" class="cruxDropButton" data-value="{{if(and(cxPropPrefixable,ifEquals(selectedItems.length,1)),concat(selectedItems[0].prefix,\':\',selectedItems[0].id),selectedItems[0].id)}}">\t\t\t\t\t\t<template is="if" value="{{expHandlers(selectedItems.length,\'==\',0)}}"><template case="true">\t\t\t\t\t\t\t<span class="lyteMarginRight">\t\t\t\t\t\t\t{{cruxGetI18n(\'None\')}}\t\t\t\t\t\t\t</span>\t\t\t\t\t\t</template><template case="false">\t\t\t\t\t\t<span class="lyteMarginRight">\t\t\t\t\t\t\t<template is="if" value="{{expHandlers(cxPropPrefixable,\'&amp;&amp;\',expHandlers(selectedItems.length,\'==\',1))}}"><template case="true">\t\t\t\t\t\t\t\t{{selectedItems[0].prefix}}: \t\t\t\t\t\t\t</template></template>{{selectedItems[0].name}}\t\t\t\t\t\t</span>\t\t\t\t\t\t<lyte-icon class="dropdown"></lyte-icon>\t\t\t\t\t\t</template></template>\t\t\t\t\t</lyte-drop-button>\t\t\t</template></template> \t\t\t<lyte-drop-box class="cruxDropbox">\t\t\t\t<div class="innerDropdownDiv">\t\t\t\t\t<template is="if" value="{{cxPropInnerDropdown}}"><template case="true">\t\t\t\t\t\t<lyte-dropdown style="width: auto; border-right: 1px solid #d6d6d6;" lt-prop-yield="true" lt-prop-search="true" lt-prop-tabindex="8" on-option-selected="{{method(&quot;innerDropdownOnOptionSelected&quot;)}}">\t\t\t\t\t\t\t<template is="registerYield" yield-name="yield">\t\t\t\t\t\t\t\t<lyte-drop-box class="parentscope">\t\t\t\t\t\t \t\t\t<lyte-drop-body>\t\t\t\t\t\t\t\t\t\t<template is="for" items="{{cxPropOptionModels}}" item="item" index="index">\t\t\t\t\t\t\t\t\t\t\t<lyte-drop-item data-value="{{index}}"> {{item.name}} </lyte-drop-item>\t\t\t\t\t\t\t\t\t\t</template>\t\t\t\t\t\t\t\t\t</lyte-drop-body>\t\t\t\t\t\t\t\t</lyte-drop-box>\t\t\t\t\t\t\t</template>\t\t\t\t\t\t</lyte-dropdown>\t\t\t\t\t</template></template>\t\t\t\t\t<template is="if" value="{{cxPropSearch}}"><template case="true">\t\t\t\t\t\t<span data-zcqa="user_dd_search_clear" class="{{if(cxPropInputValue,\'clearField\',\'\')}}" onclick="{{action(\'clearInputField\', event)}}" style="{{if(showSearchLoading,\'display:none\',\'display:inline-block\')}}"></span>\t\t\t\t\t\t<lyte-input class="cruxDropdownSearchBox" lt-prop-value="{{lbind(cxPropInputValue)}}" style="width:auto" lt-prop-placeholder="Search"></lyte-input>\t\t\t\t\t</template></template>\t\t\t\t</div>\t\t\t\t\t\t\t\t<lyte-drop-body class="cruxDropbody">\t\t\t\t\t<template is="for" items="{{cxPropOptionModels}}" item="item" index="index">\t\t\t\t\t\t<crux-dropdown-dropitem cx-prop-selected="{{item.cxPropSelected}}" cx-prop-request="{{item.model_name}}" cx-prop-name="{{item.name}}" cx-prop-image-selector="{{item.imageSelector}}" cx-prop-description-selector="{{item.descriptionSelector}}" cx-prop-prefix="{{item.prefix}}" cx-prop-id-selector="{{item.idSelector}}" cx-prop-search-action="{{item.search_action}}" change-selected="{{method(\'changeSelected\')}}" cx-prop-options="{{item.cxPropOptions}}" cx-prop-name-selector="{{item.nameSelector}}" class="{{if(ifEquals(selectedOption,index),\'shown\',\'hiden\')}}" cx-prop-type="{{if(ifEquals(cxPropOptionModels.length,1) ,\'single\',\'multiple\')}}" item-selected="{{method(\'itemSelected\')}}">\t\t\t\t\t</crux-dropdown-dropitem></template>\t\t\t\t</lyte-drop-body>\t\t\t\t<template is="if" value="{{cxPropDropboxFooterYield}}"><template case="true">\t\t\t\t\t<lyte-yield yield-name="dropbodyFooterYield"></lyte-yield>\t\t\t\t</template></template>\t\t\t</lyte-drop-box>\t\t</template>\t</lyte-dropdown></template>',_dynamicNodes:[{type:"attr",position:[1],attr:{style:{name:"style",dynamicValue:"cxPropStyle"}}},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1,1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"for",position:[1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]}},default:{}},{type:"text",position:[1,3]},{type:"componentDynamic",position:[1,5]}]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"for",position:[1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1,1,0]},{type:"attr",position:[1,3]},{type:"for",position:[1,3],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[]},false:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}}]}},default:{}},{type:"text",position:[1,3]},{type:"componentDynamic",position:[1,5]}]}]}},default:{}}]}]}},default:{}},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"text",position:[1,1]}]},false:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]}},default:{}},{type:"text",position:[1,2]},{type:"componentDynamic",position:[3]}]}},default:{}},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[3,1,1]},{type:"if",position:[3,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"for",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[3,1,3]},{type:"if",position:[3,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1],attr:{style:{name:"style",helperInfo:{name:"if",args:["showSearchLoading","'display:none'","'display:inline-block'"]}}}},{type:"attr",position:[3]},{type:"componentDynamic",position:[3]}]}},default:{}},{type:"attr",position:[3,3,1]},{type:"for",position:[3,3,1],dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[3,3]},{type:"attr",position:[3,5]},{type:"if",position:[3,5],cases:{true:{dynamicNodes:[{type:"insertYield",position:[1]}]}},default:{}},{type:"componentDynamic",position:[3]}]},{type:"componentDynamic",position:[1]}],_observedAttributes:["cxPropOptionModels","cxPropSelected","cxPropInnerDropdown","cxPropSearch","cxPropPrefixable","cxPropSortable","cxPropType","cxPropInputValue","selectedItems","selectedOption","cxPropShow","sortedIds","cxPropDropboxFooterYield","cxPropStyle","calledWithIn","newDesign"],data:function(){return{cxPropOptionModels:Lyte.attr("array"),cxPropSelected:Lyte.attr("array"),cxPropInnerDropdown:Lyte.attr("boolean"),cxPropSearch:Lyte.attr("boolean",{default:!1}),cxPropPrefixable:Lyte.attr("boolean"),cxPropSortable:Lyte.attr("boolean"),cxPropType:Lyte.attr("string",{default:"single"}),cxPropInputValue:Lyte.attr("string",{default:""}),selectedItems:Lyte.attr("array",{default:[]}),selectedOption:Lyte.attr("string",{default:"0"}),cxPropShow:Lyte.attr("boolean",{default:!1}),sortedIds:Lyte.attr("array",{default:[]}),cxPropDropboxFooterYield:Lyte.attr("boolean",{default:!1}),cxPropStyle:Lyte.attr("string"),calledWithIn:Lyte.attr("boolean",{default:!1}),newDesign:Lyte.attr("boolean",{default:!1})}},init:function(){1==this.getData("cxPropOptionModels").length?(this.setData("cxPropPrefixable",!1),this.setData("cxPropInnerDropdown",!1),this.setData("cxPropSearch",!1)):(this.setData("cxPropPrefixable",!0),this.setData("cxPropInnerDropdown",!0),this.setData("cxPropSearch",!0)),"single"==this.getData("cxPropType")&&this.setData("cxPropSortable",!1),this.$node.toggle=function(){this.querySelector(".mainCruxDropdown").toggle()},this.$node.getValue=function(){return JSON.parse(this.querySelector(".mainCruxDropdown").ltProp("selected")).join(",")}},didConnect:function(){this.makeSortable(),this.getData("cxPropSelected")&&this.getSelectedItems();for(var t=0;t<this.getData("cxPropOptionModels").length;t++)Lyte.Component.set(this.getData("cxPropOptionModels")[t],"selectedItems",[])},methods:{mainDropdownBeforeHide:function(t,e){if(this.getData("cxPropInnerDropdown")){var o=e.childComp.querySelector("div.innerDropdownDiv");if(t&&o.contains(t.target))return!1}},mainDropdownOnHide:function(){var t=this.$node.querySelector(".cruxDropButton");t.style.removeProperty("height"),t.style.height=t.scrollHeight.toString()+"px",arguments[1].childComp.querySelector(".cruxDropbody").querySelector(".shown").component.resetMixin()},mainDropdownOnShow:function(t,e){if(this.getData("cxPropInnerDropdown")){var o=e.childComp.querySelector("div.innerDropdownDiv").querySelector("lyte-dropdown");this.setData("selectedOption",o.ltProp("selected"))}(this.$node.querySelector(".mainCruxDropdown").ltProp("show")?this.$node.querySelector("lyte-dropdown").component.childComp.querySelector(".cruxDropbody"):this.$node.querySelector(".cruxDropbody")).querySelector(".shown").component.getItems()},addToList:function(t,e){var o=arguments[4].getAttribute("name"),i=arguments[4].getAttribute("image");if(this.getData("newDesign")){e=e.split(":");for(var r=0;r<this.getData("cxPropOptionModels").length;r++)this.getData("cxPropOptionModels")[r].prefix==e[0]&&Lyte.arrayUtils(this.getData("cxPropOptionModels")[r].selectedItems,"push",{name:o,id:e[1],prefix:e[0],image:i})}else 1==this.getData("cxPropOptionModels").length?Lyte.arrayUtils(this.getData("selectedItems"),"push",{name:o,id:e,image:i}):(e=e.split(":"),Lyte.arrayUtils(this.getData("selectedItems"),"push",{name:o,id:e[1],prefix:e[0],image:i}));var a=this.$node.querySelector(".cruxDropButton"),p=this.$node.querySelector('[data-value="'+e.join(":")+'"]');a.scrollTop=p.offsetTop,p.classList.add("quickSelect"),setTimeout(function(){p.classList.remove("quickSelect")},1e3),document.querySelector("lyte-drop-box:not(.lyteDropdownHidden)").querySelector(".cruxDropbody").querySelector(".shown").component.checkDropitem()},removeFromList:function(t,e){if(this.getData("newDesign"))for(r=0;r<e.length;r++){var o;this.getData("cxPropOptionModels").length>1&&(e[r]=e[r].split(":"),o=e[r][0],e[r]=e[r][1]);for(var i=0;i<this.getData("cxPropOptionModels").length;i++)if(!o||o==this.getData("cxPropOptionModels")[i].prefix)for(a=0;a<this.getData("cxPropOptionModels")[i].selectedItems.length;a++)this.getData("cxPropOptionModels")[i].selectedItems[a].id==e[r]&&Lyte.arrayUtils(this.getData("cxPropOptionModels")[i].selectedItems,"removeAt",a)}else for(var r=0;r<e.length;r++){this.getData("cxPropOptionModels").length>1&&(e[r]=e[r].split(":"),e[r]=e[r][1]);for(var a=0;a<this.getData("selectedItems").length;a++)this.getData("selectedItems")[a].id==e[r]&&Lyte.arrayUtils(this.getData("selectedItems"),"removeAt",a)}(this.$node.querySelector(".mainCruxDropdown").ltProp("show")?this.$node.querySelector("lyte-dropdown").component.childComp.querySelector(".cruxDropbody"):this.$node.querySelector(".cruxDropbody")).querySelector(".shown").component.checkDropitem()},innerDropdownOnOptionSelected:function(t,e){this.setData("selectedOption",e),this.setData("cxPropInputValue","");for(var o=document.querySelector("lyte-drop-box:not(.lyteDropdownHidden)").querySelector(".cruxDropbody"),i=0;i<o.childElementCount;i++)"CRUX-DROPDOWN-DROPITEM"==o.children[i].tagName&&o.children[i].component.resetMixin();o.querySelector(".shown").component.getItems(),o.querySelector(".shown").component.checkDropitem()},changeSelected:function(){var t=this.$node.querySelector(".mainCruxDropdown"),e=t.ltProp("selected");"single"==this.getData("cxPropType")?t.ltProp("selected",""):t.ltProp("selected","[]"),t.ltProp("selected",e)},mainDropdownOptionSelected:function(t,e){var o=t.target.innerText;this.setData("selectedItems",[]),this.setData("cxPropSelected",[]);var i=this.$node.querySelector(".mainCruxDropdown");Lyte.arrayUtils(this.getData("cxPropSelected"),"push",i.ltProp("selected")),1==this.getData("cxPropOptionModels").length?Lyte.arrayUtils(this.getData("selectedItems"),"push",{name:o,id:e}):(e=e.split(":"),Lyte.arrayUtils(this.getData("selectedItems"),"push",{name:o,id:e[1],prefix:e[0]}))}},actions:{},getSelectedItems:function(){var t=this.getData("cxPropSelected");if(1==this.getData("cxPropOptionModels").length)Lyte.objectUtils(this.getData("cxPropOptionModels")[0],"add","cxPropSelected",t);else for(var e=0;e<this.getData("cxPropOptionModels").length;e++){for(var o=[],i=t.slice(),r=0;r<i.length;r++)i[r]=i[r].split(":"),this.getData("cxPropOptionModels")[e].prefix==i[r][0]&&o.push(i[r][1]);Lyte.objectUtils(this.getData("cxPropOptionModels")[e],"add","cxPropSelected",o)}this.setSelectedItems()},setSelectedItems:function(){this.setData("selectedItems",[]);var t,e=this;t=this.$node.querySelector(".mainCruxDropdown").ltProp("show")?this.$node.querySelector("lyte-dropdown").component.childComp.querySelector(".cruxDropbody"):this.$node.querySelector(".cruxDropbody");for(var o=function(t){t&&Lyte.arrayUtils(e.getData("selectedItems"),"push",t)},i=0;i<t.childElementCount;i++)"CRUX-DROPDOWN-DROPITEM"==t.children[i].tagName&&t.children[i].component.sendSelectedData().then(o);var r=this.getData("cxPropSelected");this.$node.querySelector(".mainCruxDropdown").ltProp("selected",JSON.stringify(r))},sendInputToChild:function(){(this.$node.querySelector(".mainCruxDropdown").ltProp("show")?this.$node.querySelector("lyte-dropdown").component.childComp.querySelector(".cruxDropbody"):this.$node.querySelector(".cruxDropbody")).querySelector(".shown").component.updateInputValue(this.getData("cxPropInputValue"))},getSorted:function(){var t,e=this.$node.querySelector("lyte-drop-button.cruxDropButton");for(i=0;i<e.childNodes.length;i++)"SPAN"==(t=e.childNodes[i]).nodeName&&Lyte.arrayUtils(this.getData("sortedIds"),"push",t.getAttribute("data-value"));this.setData("calledWithIn",!0),this.setData("cxPropSelected",this.getData("sortedIds")),this.setData("sortedIds",[])},makeSortable:function(){if(this.getData("cxPropSortable")){var t=this;$L(".cruxDropButton").sortable({placeholder:"lyteSortablePlaceholder",onBeforeDrop:function(e){t.getMethods("onBeforeSort")&&t.executeMethod("onBeforeSort",e)},onDrop:function(e,o){t.getSorted(),t.getMethods("onSort")&&t.executeMethod("onSort",droppableElement,o)}})}},changeInputValue:function(){this.sendInputToChild()}.observes("cxPropInputValue"),observerSelected:function(){this.getData("calledWithIn")||this.getSelectedItems(),this.setData("calledWithIn",!1)}.observes("cxPropSelected.[]"),observerOptions:function(){this.getSelectedItems()}.observes("cxPropOptionModels.[]"),observerSelectedItems:function(){this.makeSortable()}.observes("selectedItems.[]")});