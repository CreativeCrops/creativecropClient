Lyte.Component.register("crux-combo-box",{_template:'<template tag-name="crux-combo-box">\t<lyte-dropdown lt-prop-position="down" style="{{cxPropStyle}}" lt-prop-type="multiple" class="gBB mainCruxDropdown" lt-prop-yield="true" lt-prop-tabindex="1" on-before-hide="{{method(\'mainDropdownBeforeHide\')}}" lt-prop-remove-multiple="true" on-show="{{method(\'mainDropdownOnShow\')}}" on-hide="{{method(\'mainDropdownOnHide\')}}" on-add="{{method(\'addToList\')}}" on-remove="{{method(\'removeFromList\')}}" on-option-selected="{{method(\'mainDropdownOptionSelected\')}}">\t\t<template is="registerYield" yield-name="yield">\t\t\t<lyte-drop-button class="cruxDropButton">\t\t\t\t<template is="for" items="{{cxPropOptionModels}}" item="item" index="index">\t\t\t\t\t<template is="if" value="{{expHandlers(item.selectedItems.length,\'>\',0)}}"><template case="true">\t\t\t\t\t\t<div>\t\t\t\t\t\t<div>{{item.name}}</div>\t\t\t\t\t\t\t<template is="for" items="{{item.selectedItems}}" item="select" index="index">\t\t\t\t\t\t\t<span class="cruxMultiSelect" data-value="{{concat(select.prefix,\':\',select.id)}}">\t\t\t\t\t\t\t\t<template is="if" value="{{item.imageSelector}}"><template case="true">\t\t\t\t\t\t\t\t\t<template is="if" value="{{ifEquals(select.image,\'null\')}}"><template case="true">\t\t\t\t\t\t\t\t\t <img src="/crm/CRMClient/images/nophoto.png" class="socialimg" style="height:32px;width:32px;border-radius:3px;">\t\t\t\t\t\t\t\t\t</template><template case="false">\t\t\t\t\t\t\t\t\t\t<img src="{{select.image}}" class="socialimg" style="height:32px;width:32px;border-radius:3px;">\t\t\t\t\t\t\t\t\t</template></template>\t\t\t\t\t\t\t\t</template></template>\t\t\t\t\t\t\t{{select.name}}\t\t\t\t\t\t\t\t<lyte-drop-remove class="cruxCloseIcon"></lyte-drop-remove>\t\t\t\t\t\t\t</span>\t\t\t\t\t\t\t\t\t\t\t\t</template>\t\t\t\t\t\t<div style="clear : both"></div>\t\t\t\t\t</div></template></template>\t\t\t\t</template>\t\t\t</lyte-drop-button>\t\t\t<lyte-drop-box class="cruxDropbox">\t\t\t\t<div class="innerDropdownDiv">\t\t\t\t\t\t<lyte-dropdown style="width: auto; border-right: 1px solid #d6d6d6;" lt-prop-yield="true" lt-prop-search="true" lt-prop-tabindex="8" on-option-selected="{{method(&quot;innerDropdownOnOptionSelected&quot;)}}">\t\t\t\t\t\t\t<template is="registerYield" yield-name="yield">\t\t\t\t\t\t\t\t<lyte-drop-box class="parentscope">\t\t\t\t\t\t \t\t\t<lyte-drop-body>\t\t\t\t\t\t\t\t\t\t<template is="for" items="{{cxPropOptionModels}}" item="item" index="index">\t\t\t\t\t\t\t\t\t\t\t<lyte-drop-item data-value="{{index}}"> {{item.name}} </lyte-drop-item>\t\t\t\t\t\t\t\t\t\t</template>\t\t\t\t\t\t\t\t\t</lyte-drop-body>\t\t\t\t\t\t\t\t</lyte-drop-box>\t\t\t\t\t\t\t</template>\t\t\t\t\t\t</lyte-dropdown>\t\t\t\t\t\t<span data-zcqa="user_dd_search_clear" class="{{if(cxPropInputValue,\'clearField\',\'\')}}" onclick="{{action(\'clearInputField\', event)}}" style="{{if(showSearchLoading,\'display:none\',\'display:inline-block\')}}"></span>\t\t\t\t\t\t<lyte-input class="cruxDropdownSearchBox" lt-prop-value="{{lbind(cxPropInputValue)}}" style="width:auto" lt-prop-placeholder="Search"></lyte-input>\t\t\t\t</div>\t\t\t\t\t\t\t\t<lyte-drop-body class="cruxDropbody">\t\t\t\t\t<template is="for" items="{{cxPropOptionModels}}" item="item" index="index">\t\t\t\t\t\t<crux-combo-box-dropitem cx-prop-selected="{{item.cxPropSelected}}" cx-prop-request="{{item.model_name}}" cx-prop-name="{{item.name}}" cx-prop-image-selector="{{item.imageSelector}}" cx-prop-description-selector="{{item.descriptionSelector}}" cx-prop-prefix="{{item.prefix}}" cx-prop-id-selector="{{item.idSelector}}" cx-prop-search-action="{{item.search_action}}" change-selected="{{method(\'changeSelected\')}}" cx-prop-options="{{item.cxPropOptions}}" cx-prop-name-selector="{{item.nameSelector}}" class="{{if(ifEquals(selectedOption,index),\'shown\',\'hiden\')}}" item-selected="{{method(\'itemSelected\')}}"></crux-combo-box-dropitem>\t\t\t\t\t</template>\t\t\t\t</lyte-drop-body>\t\t\t\t<template is="if" value="{{cxPropDropboxFooterYield}}"><template case="true">\t\t\t\t\t<lyte-yield yield-name="dropbodyFooterYield"></lyte-yield>\t\t\t\t</template></template>\t\t\t</lyte-drop-box>\t\t</template>\t</lyte-dropdown></template>',_dynamicNodes:[{type:"attr",position:[1],attr:{style:{name:"style",dynamicValue:"cxPropStyle"}}},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"for",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1,1,0]},{type:"attr",position:[1,3]},{type:"for",position:[1,3],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[]},false:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}}]}},default:{}},{type:"text",position:[1,3]},{type:"componentDynamic",position:[1,5]}]}]}},default:{}}]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1,1]},{type:"registerYield",position:[3,1,1,1],dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"for",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[3,1,1]},{type:"attr",position:[3,1,3],attr:{style:{name:"style",helperInfo:{name:"if",args:["showSearchLoading","'display:none'","'display:inline-block'"]}}}},{type:"attr",position:[3,1,5]},{type:"componentDynamic",position:[3,1,5]},{type:"attr",position:[3,3,1]},{type:"for",position:[3,3,1],dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[3,3]},{type:"attr",position:[3,5]},{type:"if",position:[3,5],cases:{true:{dynamicNodes:[{type:"insertYield",position:[1]}]}},default:{}},{type:"componentDynamic",position:[3]}]},{type:"componentDynamic",position:[1]}],_observedAttributes:["cxPropOptionModels","cxPropSelected","cxPropInputValue","selectedItems","selectedOption","cxPropDropboxFooterYield","cxPropStyle","calledWithIn"],data:function(){return{cxPropOptionModels:Lyte.attr("array"),cxPropSelected:Lyte.attr("array"),cxPropInputValue:Lyte.attr("string",{default:""}),selectedItems:Lyte.attr("array",{default:[]}),selectedOption:Lyte.attr("string",{default:"0"}),cxPropDropboxFooterYield:Lyte.attr("boolean",{default:!1}),cxPropStyle:Lyte.attr("string"),calledWithIn:Lyte.attr("boolean",{default:!1})}},init:function(){this.$node.toggle=function(){this.querySelector(".mainCruxDropdown").toggle()},this.$node.getValue=function(){return JSON.parse(this.querySelector(".mainCruxDropdown").ltProp("selected")).join(",")}},didConnect:function(){this.getData("cxPropSelected")&&this.getSelectedItems();for(var t=0;t<this.getData("cxPropOptionModels").length;t++)Lyte.Component.set(this.getData("cxPropOptionModels")[t],"selectedItems",[])},methods:{mainDropdownBeforeHide:function(t,e){var o=e.childComp.querySelector("div.innerDropdownDiv");if(t&&o.contains(t.target))return!1},mainDropdownOnHide:function(){this.resetHeightOfButton(),arguments[1].childComp.querySelector(".cruxDropbody").querySelector(".shown").component.resetMixin()},mainDropdownOnShow:function(t,e){var o=e.childComp.querySelector("div.innerDropdownDiv").querySelector("lyte-dropdown");this.setData("selectedOption",o.ltProp("selected")),(this.$node.querySelector(".mainCruxDropdown").ltProp("show")?this.$node.querySelector("lyte-dropdown").component.childComp.querySelector(".cruxDropbody"):this.$node.querySelector(".cruxDropbody")).querySelector(".shown").component.getItems()},addToList:function(t,e){var o=arguments[4].getAttribute("name"),i=arguments[4].getAttribute("image");e=e.split(":");for(var r=0;r<this.getData("cxPropOptionModels").length;r++)this.getData("cxPropOptionModels")[r].prefix==e[0]&&Lyte.arrayUtils(this.getData("cxPropOptionModels")[r].selectedItems,"push",{name:o,id:e[1],prefix:e[0],image:i});var n=this.$node.querySelector(".cruxDropButton"),p=this.$node.querySelector('[data-value="'+e.join(":")+'"]');n.scrollTop=p.offsetTop,p.classList.add("quickSelect"),setTimeout(function(){p.classList.remove("quickSelect")},300),document.querySelector("lyte-drop-box:not(.lyteDropdownHidden)").querySelector(".cruxDropbody").querySelector(".shown").component.checkDropitem(),this.getMethods("onAdd")&&this.executeMethods("onAdd",arguments[0],arguments[1],arguments[2],arguments[3],arguments[4])},removeFromList:function(t,e){for(var o=this,i=0;i<e.length;i++){e[i]=e[i].split(":");var r=e[i][0];e[i]=e[i][1];for(var n=0;n<this.getData("cxPropOptionModels").length;n++)if(!r||r==this.getData("cxPropOptionModels")[n].prefix)for(var p=0;p<this.getData("cxPropOptionModels")[n].selectedItems.length;p++)this.getData("cxPropOptionModels")[n].selectedItems[p].id==e[i]&&Lyte.arrayUtils(this.getData("cxPropOptionModels")[n].selectedItems,"removeAt",p)}clearTimeout(this.c),this.c=setTimeout(function(){o.resetHeightOfButton()},700),(this.$node.querySelector(".mainCruxDropdown").ltProp("show")?this.$node.querySelector("lyte-dropdown").component.childComp.querySelector(".cruxDropbody"):this.$node.querySelector(".cruxDropbody")).querySelector(".shown").component.checkDropitem(),this.getMethods("onRemove")&&this.executeMethods("onRemove",arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},innerDropdownOnOptionSelected:function(t,e){this.setData("selectedOption",e),this.setData("cxPropInputValue","");for(var o=document.querySelector("lyte-drop-box:not(.lyteDropdownHidden)").querySelector(".cruxDropbody"),i=0;i<o.childElementCount;i++)"CRUX-COMBO-BOX-DROPITEM"==o.children[i].tagName&&o.children[i].component.resetMixin();o.querySelector(".shown").component.getItems(),o.querySelector(".shown").component.checkDropitem()},changeSelected:function(){var t=this.$node.querySelector(".mainCruxDropdown"),e=t.ltProp("selected");t.ltProp("selected","[]"),t.ltProp("selected",e)}},actions:{clearInputField:function(){this.setData("cxPropInputValue","")}},getSelectedItems:function(){for(var t=this.getData("cxPropSelected"),e=0;e<this.getData("cxPropOptionModels").length;e++){for(var o=[],i=t.slice(),r=0;r<i.length;r++)i[r]=i[r].split(":"),this.getData("cxPropOptionModels")[e].prefix==i[r][0]&&o.push(i[r][1]);Lyte.objectUtils(this.getData("cxPropOptionModels")[e],"add","cxPropSelected",o)}this.setSelectedItems()},setSelectedItems:function(){this.setData("selectedItems",[]);var t,e=this;t=this.$node.querySelector(".mainCruxDropdown").ltProp("show")?this.$node.querySelector("lyte-dropdown").component.childComp.querySelector(".cruxDropbody"):this.$node.querySelector(".cruxDropbody");for(var o=function(t){if(t)for(var o=0;o<e.getData("cxPropOptionModels").length;o++)e.getData("cxPropOptionModels")[o].prefix==t[0].prefix&&Lyte.arrayUtils(e.getData("cxPropOptionModels")[o].selectedItems,"push",t)},i=0;i<t.childElementCount;i++)"CRUX-COMBO-BOX-DROPITEM"==t.children[i].tagName&&t.children[i].component.sendSelectedData().then(o);this.resetHeightOfButton();var r=this.getData("cxPropSelected");this.$node.querySelector(".mainCruxDropdown").ltProp("selected",JSON.stringify(r))},sendInputToChild:function(){(this.$node.querySelector(".mainCruxDropdown").ltProp("show")?this.$node.querySelector("lyte-dropdown").component.childComp.querySelector(".cruxDropbody"):this.$node.querySelector(".cruxDropbody")).querySelector(".shown").component.updateInputValue(this.getData("cxPropInputValue"))},changeInputValue:function(){this.sendInputToChild()}.observes("cxPropInputValue"),observerSelected:function(){this.getData("calledWithIn")||this.getSelectedItems(),this.setData("calledWithIn",!1)}.observes("cxPropSelected.[]"),observerOptions:function(){this.getSelectedItems()}.observes("cxPropOptionModels.[]"),resetHeightOfButton:function(){var t=this.$node.querySelector(".cruxDropButton");$L.fastdom.mutate(function(){t.style.removeProperty("height"),$L.fastdom.measure(function(){var e=t.scrollHeight;$L.fastdom.mutate(function(){t.style.height=e+"px"})})}.bind(this))}});