Lyte.Component.register("crux-criteria-editor",{_template:'<template tag-name="crux-criteria-editor">\t<template is="if" value="{{expHandlers(cxPropType,\'==\',\'create\')}}"><template case="true">\t\t<lyte-alert lt-prop-type="warning" id="patternWarning"></lyte-alert>\t\t<div class="pwie">\t\t\t<div id="criteriaDiv">\t\t\t\t<lyte-table lt-prop-yield="true" id="criteriaTable" lt-prop-prevent-scrollbar="true">\t\t\t\t<template is="registerYield" yield-name="yield">\t\t\t\t     <lyte-table-structure>\t\t\t\t        <lyte-tbody>\t\t\t\t           <lyte-tr>\t\t\t\t                <lyte-td>\t\t\t\t                \t<div>\t\t\t\t                \t\t<lyte-table lt-prop-yield="true" id="searchlayer_new" class="newApCriteriaTable newCriUi newSrchView">\t\t\t\t\t\t\t\t\t\t<template is="registerYield" yield-name="yield">\t\t\t\t\t\t\t\t\t\t     <lyte-table-structure>\t\t\t\t\t\t\t\t\t\t        <lyte-tbody class="criteriaHeader" id="{{totalCriteria}}">\t\t\t\t\t\t\t\t\t\t        \t<template is="for" items="{{arr}}" item="val" index="index">\t\t\t\t\t\t\t\t\t\t           <lyte-tr id="searchcrt{{add(index,1)}}" class="searchcrt" data-index="1">\t\t\t\t\t\t\t\t\t\t                <crux-criteria-editor-header id="criteriaEditorHeader{{add(index,1)}}" module="{{cxPropModule}}" on-operator-change-call="{{method(\'onOperatorChangeCall\')}}" criteria-array-object-update="{{method(\'criteriaArrayObjectUpdate\')}}" on-field-change-call="{{method(\'onFieldChangeCall\')}}" and-or-condition="{{patternArrDis[index]}}" criteria-index="{{add(index,1)}}" show-add="{{if(ifEquals(arr.length, add(index,1)), true, false)}}" show-remove="{{if(ifEquals(arr.length,1), false, true)}}" fields="{{cxPropFields}}" tags="{{tags}}" layout="{{layout}}" set-criteria-obj="{{unbound(if(setCriteriaObj[index],setCriteriaObj[index]))}}" remove-pattern="{{cxPropRemovePattern}}"></crux-criteria-editor-header>\t\t\t\t\t\t\t\t\t\t            </lyte-tr>     \t\t\t\t\t\t\t\t\t\t\t        \t</template>\t\t\t\t\t\t\t\t\t\t        \t<template is="if" value="{{expHandlers(expHandlers(arr.length,\'>\',1),\'&amp;&amp;\',expHandlers(cxPropRemovePattern,\'!\'))}}"><template case="true">\t\t\t\t\t\t\t\t\t\t            <lyte-tr>\t\t\t\t\t\t\t\t\t\t            <div class="w100per oH new_pat_edtr gBB" id="changePattern">\t\t\t\t\t\t\t\t\t\t            <lyte-td></lyte-td>\t\t\t\t\t\t\t\t\t\t            <lyte-td>\t\t\t\t\t\t\t\t\t\t            \t<span class="wf_form_lab dIB vam">{{cruxGetI18n("crm.label.criteria.pattern")}}</span>\t\t\t\t\t\t\t\t\t\t            </lyte-td>\t\t\t\t\t\t\t\t\t\t            <lyte-td>\t\t\t\t\t\t\t\t\t            \t\t\t<lyte-input lt-prop-disabled="{{if(ifEquals(showEdit,true), false, true)}}" lt-prop-height="40px" lt-prop-text-area-resize="{}" lt-prop-type="textarea" class="criteriaPatternText" lt-prop-value="{{lbind(criteria)}}" lt-prop-id="lyteInputCriteria" lt-prop-rows="5" lt-prop-cols="60"></lyte-input>\t\t\t\t\t\t\t\t\t\t            </lyte-td>\t\t\t\t\t\t\t\t\t\t            <lyte-td>\t\t\t\t\t\t\t\t\t\t\t            \t<template is="if" value="{{expHandlers(showEdit,\'!\')}}"><template case="true">\t\t\t\t\t\t\t\t\t\t\t            \t<span style="padding: 5px; cursor:pointer; color: blue" onclick="{{action(\'openEditCriteria\')}}">{{cruxGetI18n("crm.label.edit.criteria.pattern")}}</span>\t\t\t\t\t\t\t\t\t\t\t            \t</template><template case="false">\t\t\t\t\t\t\t\t\t\t\t            \t<span style="padding: 5px; cursor:pointer;  color: blue" onclick="{{action(\'saveCriteriaPattern\')}}">{{cruxGetI18n("crm.button.save")}}</span>\t\t\t\t\t\t\t\t\t\t\t            \t<span style="padding: 5px; cursor:pointer;" onclick="{{action(\'closeEditCriteria\')}}">{{cruxGetI18n("crm.button.cancel")}}</span>\t\t\t\t\t\t\t\t\t\t\t            \t</template></template>\t\t\t\t\t\t\t\t\t\t            </lyte-td>\t\t\t\t\t\t\t\t\t\t            </div></lyte-tr></template></template>\t\t\t\t\t\t\t\t\t\t             \t\t\t\t\t\t\t\t\t\t            \t\t\t\t\t\t\t  \t\t\t        </lyte-tbody> \t\t\t\t\t\t\t\t\t\t     </lyte-table-structure>\t\t\t\t\t\t\t\t\t\t </template> \t\t\t\t\t\t\t\t\t</lyte-table>\t\t\t\t                \t</div>\t\t\t\t                 </lyte-td>\t\t\t\t            </lyte-tr> \t  \t\t\t        </lyte-tbody> \t\t\t\t     </lyte-table-structure>\t\t\t\t </template> \t\t\t</lyte-table>\t\t\t</div>\t\t</div>\t</template></template><template is="if" value="{{expHandlers(cxPropType,\'==\',\'view\')}}"><template case="true">\t\t<div class="pwie">\t\t\t<div id="criteriaDiv">\t\t\t\t<lyte-table lt-prop-yield="true" id="criteriaTable">\t\t\t\t<template is="registerYield" yield-name="yield">\t\t\t\t     <lyte-table-structure>\t\t\t\t        <lyte-tbody>\t\t\t\t           <lyte-tr>\t\t\t\t                <lyte-td>\t\t\t\t                \t<div>\t\t\t\t                \t\t<lyte-table lt-prop-yield="true" id="searchlayer_new" class="newApCriteriaTable newCriUi newSrchView">\t\t\t\t\t\t\t\t\t\t<template is="registerYield" yield-name="yield">\t\t\t\t\t\t\t\t\t\t     <lyte-table-structure>\t\t\t\t\t\t\t\t\t\t        <lyte-tbody class="criteriaHeader" id="{{totalCriteria}}">\t\t\t\t\t\t\t\t\t\t        \t<template is="for" items="{{arr}}" item="val" index="index">\t\t\t\t\t\t\t\t\t\t\t        \t <lyte-tr id="searchcrt{{add(index,1)}}" class="searchcrt" data-index="1">\t\t\t\t\t\t\t\t\t\t                <crux-criteria-editor-view-header id="criteriaEditorHeader{{add(index,1)}}" module="{{cxPropModule}}" criteria-index="{{add(index,1)}}" and-or-condition="{{patternArrDis[index]}}" fields="{{cxPropFields}}" criteria="{{unbound(if(setCriteriaObj[index],setCriteriaObj[index]))}}" remove-pattern="{{cxPropRemovePattern}}"></crux-criteria-editor-view-header>\t\t\t\t\t\t\t\t\t\t            </lyte-tr> \t\t\t\t\t        \t\t\t\t\t\t\t\t\t\t\t        \t</template>\t\t\t\t\t\t\t\t\t\t        \t<template is="if" value="{{expHandlers(arr.length,\'>\',1)}}"><template case="true">\t\t\t\t\t\t\t\t\t\t            <lyte-tr>\t\t\t\t\t\t\t\t\t\t            <div class="w100per oH new_pat_edtr gBB" id="changePattern">\t\t\t\t\t\t\t\t\t\t            <lyte-td></lyte-td>\t\t\t\t\t\t\t\t\t\t            <lyte-td>\t\t\t\t\t\t\t\t\t\t            \t<span class="wf_form_lab dIB vam">{{cruxGetI18n("crm.label.criteria.pattern")}}</span>\t\t\t\t\t\t\t\t\t\t            </lyte-td>\t\t\t\t\t\t\t\t\t\t            <lyte-td>\t\t\t\t\t\t\t\t\t            \t\t\t<lyte-input lt-prop-disabled="true" lt-prop-height="40px" lt-prop-text-area-resize="{}" class="criteriaPatternText" lt-prop-id="lyteInputCriteria" lt-prop-rows="5" lt-prop-value="{{lbind(criteria)}}" lt-prop-cols="60"></lyte-input>\t\t\t\t\t\t\t\t\t\t            </lyte-td>\t\t\t\t\t\t\t\t\t\t            </div></lyte-tr></template></template>\t\t\t\t\t\t\t\t\t\t             \t\t\t\t\t\t\t\t\t\t            \t\t\t\t\t\t\t  \t\t\t        </lyte-tbody> \t\t\t\t\t\t\t\t\t\t     </lyte-table-structure>\t\t\t\t\t\t\t\t\t\t </template> \t\t\t\t\t\t\t\t\t</lyte-table>\t\t\t\t                \t</div>\t\t\t\t                 </lyte-td>\t\t\t\t            </lyte-tr> \t  \t\t\t        </lyte-tbody> \t\t\t\t     </lyte-table-structure>\t\t\t\t </template> \t\t\t</lyte-table>\t\t\t</div>\t\t</div>\t</template></template></template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"componentDynamic",position:[1]},{type:"registerYield",position:[3,1,1,1],dynamicNodes:[{type:"registerYield",position:[1,1,1,1,1,1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"attr",position:[1,1,1]},{type:"for",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"attr",position:[1,1,3]},{type:"if",position:[1,1,3],cases:{true:{dynamicNodes:[{type:"componentDynamic",position:[1,1,1]},{type:"text",position:[1,1,3,1,0]},{type:"componentDynamic",position:[1,1,3]},{type:"attr",position:[1,1,5,1]},{type:"componentDynamic",position:[1,1,5,1]},{type:"componentDynamic",position:[1,1,5]},{type:"attr",position:[1,1,7,1]},{type:"if",position:[1,1,7,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]},{type:"attr",position:[3]},{type:"text",position:[3,0]}]}},default:{}},{type:"componentDynamic",position:[1,1,7]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,1,1,1,1,1]},{type:"componentDynamic",position:[1,1,1,1]},{type:"componentDynamic",position:[1,1,1]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[3,1,1]}]}},default:{}},{type:"attr",position:[2]},{type:"if",position:[2],cases:{true:{dynamicNodes:[{type:"registerYield",position:[1,1,1,1],dynamicNodes:[{type:"registerYield",position:[1,1,1,1,1,1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"attr",position:[1,1,1]},{type:"for",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"attr",position:[1,1,3]},{type:"if",position:[1,1,3],cases:{true:{dynamicNodes:[{type:"componentDynamic",position:[1,1,1]},{type:"text",position:[1,1,3,1,0]},{type:"componentDynamic",position:[1,1,3]},{type:"attr",position:[1,1,5,1]},{type:"componentDynamic",position:[1,1,5,1]},{type:"componentDynamic",position:[1,1,5]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,1,1,1,1,1]},{type:"componentDynamic",position:[1,1,1,1]},{type:"componentDynamic",position:[1,1,1]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,1,1]}]}},default:{}}],_observedAttributes:["cxPropFields","totalCriteria","cxPropModule","arr","patternArr","showEdit","criteria","patternArrDis","bufferCriteria","shownAlert","criteriaArrayObject","cxPropSetCriteria","setCriteriaObj","moduleId","cxPropType","response","setCriteriaViewObj","getFields","cxPropMaxCount","cxPropRemovePattern","cxPropSpecifiedCondition","defaultCondition","defaultLabelCondition"],data:function(){return{cxPropFields:Lyte.attr("array"),totalCriteria:Lyte.attr("number",{default:1}),cxPropModule:Lyte.attr("string"),arr:Lyte.attr("array",{default:[1]}),patternArr:Lyte.attr("array",{default:[" "]}),showEdit:Lyte.attr("boolean",{default:!1}),criteria:Lyte.attr("string",{default:"1"}),patternArrDis:Lyte.attr("array",{default:[" "]}),bufferCriteria:Lyte.attr("string"),shownAlert:Lyte.attr("boolean",{default:!1}),criteriaArrayObject:Lyte.attr("array",{default:[]}),cxPropSetCriteria:Lyte.attr("object"),setCriteriaObj:Lyte.attr("array"),moduleId:Lyte.attr("string"),cxPropType:Lyte.attr("string",{default:"create"}),response:Lyte.attr("string",{default:"new"}),setCriteriaViewObj:Lyte.attr("array"),getFields:Lyte.attr("boolean",{default:!1}),cxPropMaxCount:Lyte.attr("number",{default:25}),cxPropRemovePattern:Lyte.attr("boolean",{default:!1}),cxPropSpecifiedCondition:Lyte.attr("string"),defaultCondition:Lyte.attr("string",{default:_cruxUtils.getI18n("and")}),defaultLabelCondition:Lyte.attr("string",{default:_cruxUtils.getI18n("crm.label.and")})}},didConnect:function(){this.onGetFieldsSucess()},getFieldsList:function(){function t(t,e){const r=t.field_label,i=e.field_label;let a=0;return r>i?a=1:r<i&&(a=-1),a}var e=this;if(void 0==this.getData("cxPropFields")){if(this.getData("cxPropModule"))if(this.setData("moduleId",moduleRecordMapping[this.getData("cxPropModule")].id),store.peekRecord("module",this.getData("moduleId")).fields){var r=store.peekRecord("module",this.getData("moduleId")).fields;this.getMethods("onFieldConstruction")&&(r=this.executeMethod("onFieldConstruction",r)),this.setData("cxPropFields",r.sort(t)),this.setData("getFields",!0),this.onGetFieldsSucess()}else store.findRecord("module",this.getData("moduleId")).then(function(r){var i;i=e.getMethods("onFieldConstruction")?e.executeMethod("onFieldConstruction",r[0].fields):r[0].fields,e.setData("cxPropFields",i.sort(t)),e.setData("getFields",!0),e.onGetFieldsSucess()})}else this.setData("cxPropFields",this.getData("cxPropFields").sort(t)),e.setData("getFields",!0)},onGetFieldsSucess:function(){this.getData("getFields")&&this.getData("cxPropSetCriteria")&&this.setCriteria(this.getData("cxPropSetCriteria"))},init:function(){this.getData("cxPropSpecifiedCondition")&&("and"==this.getData("cxPropSpecifiedCondition")?(this.setData("defaultCondition",_cruxUtils.getI18n("and")),this.setData("defaultLabelCondition",_cruxUtils.getI18n("crm.label.and"))):"or"==this.getData("cxPropSpecifiedCondition")&&(this.setData("defaultCondition",_cruxUtils.getI18n("or")),this.setData("defaultLabelCondition",_cruxUtils.getI18n("crm.label.or"))),this.setData("cxPropRemovePattern",!0)),this.getFieldsList(),this.$node.getCriteria=function(){return this.component.getCriteria()}},validatePattern:function(t,e,r){e=void 0!==e?e:"";var i=(t=t.replace(/#/g,"~")).match(/\(/gi);if(i)var a=i.length;var n=t.match(/\)/gi);if(n)var o=n.length;if(a!=o)return this.showAlert(_cruxUtils.getI18n("criteria.error.alert.brackets.count.mismatch")),this.setData("shownAlert",!0),!1;var s=t.replace(/(and|or)/g,"#").split(" ").join("").replace(/\n/g,"");if(-1!=s.indexOf("(#")||-1!=s.indexOf("#)"))return this.showAlert(_cruxUtils.getI18n("criteria.error.alert.brackets.invalid")),this.setData("shownAlert",!0),!1;if(-1!=s.indexOf("()"))return this.showAlert(_cruxUtils.getI18n("criteria.error.alert.brackets.invalid")),this.setData("shownAlert",!0),!1;var l=s.replace(/[()]/g,"#"),c=t.match(/[0-9]+/g);if(null!=c)for(var p=c.length,d=0;d<p;d++)if(c[d]!=d+1)return this.showAlert(_cruxUtils.getI18n("crm.criteria.number.notmatch.check",c[d])),this.setData("shownAlert",!0),!1;var h=l.replace(/[0-9]+/g,"#").replace(/#/g,"");if(h&&h.length>=1)return this.showAlert(_cruxUtils.getI18n("criteria.error.alert.other.params")),this.setData("shownAlert",!0),!1;var u=t.match(/(and|or)/gi);return r=r||Search["rowcnt"+e],u&&r-1!==u.length?(this.showAlert(_cruxUtils.getI18n("criteria.error.alert.andor.rowcount.mismatch")),this.setData("shownAlert",!0),!1):r!=l.replace(/[0-9]+/g,"$").replace(/#/g,"").length?(this.showAlert(_cruxUtils.getI18n("criteria.error.alert.critnum.rowcount.mismatch")),this.setData("shownAlert",!0),!1):t=(t=this.addSpaceBetweenParanthesis(t)).replace(/\n/g,"")},savePattern:function(t,e,r,i){t=void 0!==t?t:"";var a=e,n=i.split(" ").join("");if(!(n=this.validatePattern(n,t,a)))return!1;n.replace(new RegExp("and","g"),_cruxUtils.getI18n("and")).replace(new RegExp("or","g"),_cruxUtils.getI18n("or"));return this.updateCriteriaRowsBasedOnChangedPattern(n),n},updateCriteriaRowsBasedOnChangedPattern:function(t){for(var e=[" "],r=t.match(/(and|or)/gi),i=[" "],a=r.length,n=0;n<a;n++)e.push(r[n]),r[n]==_cruxUtils.getI18n("or")?i.push(_cruxUtils.getI18n("crm.label.or")):r[n]==_cruxUtils.getI18n("and")&&i.push(_cruxUtils.getI18n("crm.label.and"));this.setData("patternArr",e),this.setData("patternArrDis",i)},criteriaOption:function(t,e){var r=this.getData("patternArr"),i=this.getData("criteria");if("add"==t)i="("+i+r[e-1]+e+")";else if("remove"==t){var a=0,n=e+" ";i=(i=i.replace(/(and|or)/g,"#")).replace(/#/g,function(t){return++a===(1!=e?e-1:e)?"":t});var o=new RegExp(n,"g");a=0;i=(i=i.replace(o,"")).replace(/#/g,function(t){return++a<=r.length?r[a]:t});a=1;i=(i=(i=i.replace(/[0-9]/g,"#")).replace(/##/g,"#")).replace(/#/g,function(t){return a<=i.match(/#/g).length?a++:t})}else if("mod"==t){a=0;i=(i=i.replace(/(and|or)/g,"#")).replace(/#/g,function(t){return++a<=r.length?r[a]:t})}for(i=i.replace(/ /g,"");i.match(/\(\)/g,"");)i=i.replace(/\(\)/g,"");i=this.addSpaceBetweenParanthesis(i),this.setData("criteria",i)},showAlert:function(t){var e=!0;if(this.getMethods("onBeforeErrorAlert")&&(e=this.executeMethod("onBeforeErrorAlert",t)),e){var r=this.$node.querySelector("#patternWarning");r.ltProp("primaryMessage",t),r.ltProp("heading","Warning Alert"),r.ltProp("show",!0),this.getMethods("onErrorAlert")&&this.executeMethod("onErrorAlert",t)}},checkValuesCondition:function(){for(var t=this.getData("criteriaArrayObject"),e=t.length,r=1;r<e;r++){for(var i,a=t[r],n=0;n<this.getData("cxPropFields").length;n++)if(a.api_name==this.getData("cxPropFields")[n].api_name){i=this.getData("cxPropFields")[n].field_label;break}if(""==a.api_name||"None"==a.api_name||null==a.api_name)return this.showAlert(_cruxUtils.getI18n("crm.criteria.fieldlabel.valid.check",r)),!1;if(""==a.comparator||"None"==a.comparator||null==a.api_name)return this.showAlert(_cruxUtils.getI18n("crm.criteria.condition.valid.check",i)),!1;if(""==a.value||null==a.api_name)return this.showAlert(_cruxUtils.getI18n("crm.field.valid.check",i)),!1;if(a.comparator.match(/between/)&&a.value[0]>a.value[1])return this.showAlert(_cruxUtils.getI18n("crm.custom.field.less.than.to")),!1}return!0},getCriteria:function(){for(var t=0;t<this.getData("totalCriteria");t++)this.$node.getElementsByTagName("crux-criteria-editor-header")[t].component.getValue();var e=this.getData("criteriaArrayObject");if(this.checkValuesCondition()){if("new"==this.getData("response")){var r=e,i=this.getData("criteria");i=(i=(i=(i=i.replace(/ /g,"")).replace(/and/g,"+").replace(/or/g,"-")).replace(/[0-9]/g,"#")).replace(/##/g,"#");for(var a=[],n=[],o=[],s=(t=0,1);t<i.length;t++)if("("==i[t])a.push(i[t]);else if("+"==i[t]||"-"==i[t])n.push(i[t]);else if(")"==i[t]){if(o.length>1){a.pop();var l=[];l.push(o.pop()),l.push(o.pop()),l.reverse();var c=n.pop();"+"==c?c="and":"-"==c&&(c="or"),o.push({group_operator:c,group:l})}}else o.push(r[s++]);o=o[0]}else{var p=0;o="["+(r=(r=(r=(r=(r=(r=this.getData("criteria")).replace(/\( /g,"[").replace(/ \)/g,"]")).replace(/ and /g,',"and",').replace(/ or /g,',"or",')).replace(/[0-9]/g,"#")).replace(/##/g,"#")).replace(/#/g,function(t){return++p<=e.length?JSON.stringify(e[p]):t}))+"]"}return this.setData("setCriteriaObj",this.getData("criteriaArrayObject")),Lyte.arrayUtils(this.getData("setCriteriaObj"),"removeAt",0),o}},inorder:function(t,e){return null!==t&&(null!=t.left&&(e+="("),e=this.inorder(t.left,e),e+=t.value,e=this.inorder(t.right,e),null!=t.right&&(e+=")")),e},setCriteria:function(t){this.setData("arr",[]),this.setData("patternArrDis",[" "]),this.setData("patternArr",[" "]);JSON.stringify(t);if("new"==this.getData("response")){var e=new function t(e,r,i){e.group_operator?(this.value=e.group_operator,r.push(e.group_operator),this.left=new t(e.group[0],r,i),this.right=new t(e.group[1],r,i)):(i.push(e),this.value=i.length,this.left=null,this.right=null),this.andOr=r,this.criteria=i}(t,[],[]);s=this.inorder(e,"");var r=e.andOr;this.setData("setCriteriaObj",e.criteria),this.setData("criteria",this.changeToInternational(s)),this.setData("totalCriteria",e.criteria.length)}else{r=t.match(/("and"|"or")/g);var i=this.getCriteriaPattern(t);this.setData("criteria",i[0]),this.setData("setCriteriaObj",i[1]),this.setData("totalCriteria",i[2])}if(null!=r)for(var a=r.length,n=0;n<a;n++)r[n]=r[n].replace(/"/g,""),r[n]==_cruxUtils.getI18n("and")?(Lyte.arrayUtils(this.getData("patternArrDis"),"push",_cruxUtils.getI18n("crm.label.and")),Lyte.arrayUtils(this.getData("patternArr"),"push",_cruxUtils.getI18n("and"))):r[n]==_cruxUtils.getI18n("or")&&(Lyte.arrayUtils(this.getData("patternArrDis"),"push",_cruxUtils.getI18n("crm.label.or")),Lyte.arrayUtils(this.getData("patternArr"),"push",_cruxUtils.getI18n("or")));for(n=0;n<this.getData("totalCriteria");n++)Lyte.arrayUtils(this.getData("arr"),"push",n+1)},changeToInternational:function(t){return pattern=t.replace(/AND|OR/g,function(t){return"AND"==t?_cruxUtils.getI18n("and"):"OR"==t?_cruxUtils.getI18n("or"):void 0}),this.addSpaceBetweenParanthesis(pattern)},addSpaceBetweenParanthesis:function(t){for(var e="",r=(t=t.replace(/\s/g,"")).length,i=0;i<r;i++){var a=t.charAt(i);"("==a||"d"==a||"r"==a?e=e+a+" ":")"==a||"a"==a||"o"==a?e=e+" "+a:e+=a}return e},actions:{createNewCriteria:function(){var t=!0,e=this.getData("totalCriteria");this.getMethods("onBeforeAddCriteria")&&(t=this.executeMethod("onBeforeAddCriteria",e+1)),t&&(this.getData("showEdit")?this.showAlert(_cruxUtils.getI18n("crm.alert.label.savepattern")):e>=this.getData("cxPropMaxCount")?this.showAlert(_cruxUtils.getI18n("crm.criteria.max.rowcnt.exceeds")):(Lyte.arrayUtils(this.getData("patternArrDis"),"push",this.getData("defaultLabelCondition")),e+=1,Lyte.arrayUtils(this.getData("patternArr"),"push",this.getData("defaultCondition")),Lyte.arrayUtils(this.getData("arr"),"push",e),this.setData("totalCriteria",e),this.criteriaOption("add",e),this.getMethods("onAddCriteria")&&this.executeMethod("onAddCriteria",e)))},removeCriteria:function(t){var e=!0,r=this.getData("totalCriteria");this.getMethods("onBeforeDeleteCriteria")&&(e=this.executeMethod("onBeforeDeleteCriteria",r)),e&&(this.getData("showEdit")?this.showAlert(_cruxUtils.getI18n("crm.alert.label.savepattern")):(r-=1,this.setData("totalCriteria",r),Lyte.arrayUtils(this.getData("patternArrDis"),"removeAt",1!=t?t-1:t),Lyte.arrayUtils(this.getData("patternArr"),"removeAt",1!=t?t-1:t),Lyte.arrayUtils(this.getData("arr"),"removeAt",t-1),Lyte.arrayUtils(this.getData("criteriaArrayObject"),"removeAt",t),this.getData("setCriteriaObj")&&this.getData("setCriteriaObj")[1!=t?t-1:t]&&Lyte.arrayUtils(this.getData("setCriteriaObj"),"removeAt",1!=t?t-1:t),this.criteriaOption("remove",t),this.getMethods("onDeleteCriteria")&&this.executeMethod("onDeleteCriteria",r+1)))},openEditCriteria:function(){var t=!0;this.getMethods("onBeforeEditPattern")&&(t=this.executeMethod("onBeforeEditPattern",this.getData("criteria"))),t&&(this.setData("bufferCriteria",this.getData("criteria")),this.setData("showEdit",!0),this.getMethods("onEditPattern")&&this.executeMethod("onEditPattern",this.getData("criteria")))},closeEditCriteria:function(){var t=this.getData("criteria");this.setData("criteria",this.getData("bufferCriteria")),this.setData("showEdit",!1),this.getMethods("onCancelPattern")&&this.executeMethod("onCancelPattern",t)},saveCriteriaPattern:function(){var t=!0;if(this.getMethods("onBeforeSavePattern")&&(t=this.executeMethod("onBeforeSavePattern",this.getData("criteria"))),t){var e=this.getData("criteria"),r=this.savePattern("",this.getData("totalCriteria"),!0,e);this.getData("shownAlert")?this.setData("shownAlert",!1):(this.setData("criteria",r),this.setData("showEdit",!1)),this.getMethods("onSavePattern")&&this.executeMethod("onSavePattern",this.getData("criteria"))}},changeAndOr:function(t,e){var r,i,a=!0;(this.getMethods("onBeforeConditionChange")&&(a=this.executeMethod("onBeforeConditionChange",e,t)),a)&&(t==_cruxUtils.getI18n("crm.label.or")?(i=_cruxUtils.getI18n("crm.label.and"),r=_cruxUtils.getI18n("and")):t==_cruxUtils.getI18n("crm.label.and")&&(r=_cruxUtils.getI18n("or"),i=_cruxUtils.getI18n("crm.label.or")),Lyte.arrayUtils(this.getData("patternArr"),"replaceAt",e-1,r),Lyte.arrayUtils(this.getData("patternArrDis"),"replaceAt",e-1,i),this.criteriaOption("mod",e),this.getMethods("onConditionChange")&&this.executeMethod("onConditionChange",e,t))}},methods:{onFieldChangeCall:function(){this.getMethods("onFieldChange")&&this.executeMethod("onFieldChange",arguments[0],arguments[1])},onOperatorChangeCall:function(){this.getMethods("onOperatorChange")&&this.executeMethod("onOperatorChange",arguments[0],arguments[1])},criteriaArrayObjectUpdate:function(t,e){var r=this.getData("criteriaArrayObject");r[e]=t,this.setData("criteriaArrayObject",r)}},setCriteriaObserver:function(){this.onGetFieldsSucess()}.observes("cxPropSetCriteria"),moduleObserver:function(){this.getFieldsList()}.observes("cxPropModule")},{mixins:["crux-criteria-util"]});