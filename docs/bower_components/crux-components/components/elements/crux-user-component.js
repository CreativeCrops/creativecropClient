Lyte.Component.register("crux-user-component",{_template:'<template tag-name="crux-user-component">\t<template is="switch" value="{{cxPropFrom}}"><template case="view">\t\t\t<span class="lv_data_username ellipsistext vam dIB" onmouseover="{{action(\'showBCard\')}}" onmouseout="{{action(\'hideBCard\')}}">{{name}}</span>\t\t</template><template case="criteria"></template><template case="filter"></template><template case="create">\t\t\t<crux-user-dropdown cx-prop-type="{{if(ifEquals(cxPropFrom,\'create\'),\'single\', \'multiple\')}}" cx-prop-searchable="true" cx-prop-selected-users="{{selectedUsers}}" cx-prop-no-user-label="{{cruxGetI18n(\'crm.label.select.user\')}}"></crux-user-dropdown>\t\t</template></template></template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"switch",position:[1],cases:{view:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]},criteria:{dynamicNodes:[],additional:{next:"filter"}},filter:{dynamicNodes:[],additional:{next:"create"}},create:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}}],_observedAttributes:["cxPropValue","cxPropIdSelector","cxPropNameSelector","cxPropFrom","cxPropEmptyValue","selectedUsers"],data:function(){return{cxPropValue:Lyte.attr("object"),cxPropIdSelector:Lyte.attr("string",{default:"id"}),cxPropNameSelector:Lyte.attr("string",{default:"name"}),cxPropFrom:Lyte.attr("string",{default:"view"}),cxPropEmptyValue:Lyte.attr("string",{default:""}),selectedUsers:Lyte.attr("array")}},init:function(){if("view"==this.getData("cxPropFrom"))if(this.getData("cxPropValue")){var e=this.getData("cxPropValue");this.setData({id:e[this.getData("cxPropIdSelector")],name:e[this.getData("cxPropNameSelector")]})}else this.setData("cxPropValue",this.getData("cxPropEmptyValueo"))},actions:{showBCard:function(){clearTimeout(this.bcTimeout);var e=this;this.bcTimeout=setTimeout(function(){var t=document.getElementsByTagName("crux-user-tooltip")[0],r=e.getData("cxPropValue")[e.getData("cxPropIdSelector")];e.$node.querySelector("span").classList.add("userHover"),t||(t=Lyte.Component.render("crux-user-tooltip",{},"body")).setMethods({BCardHover:function(){clearTimeout(e.bcTimeout)},BCardOut:function(){e.hideBCard()}}),t.setData({elemId:".userHover",userId:r,contactServerUrl:crmConstants.contactsPhotoURL}),document.getElementById("popoverTooltip").ltProp("show",!0)},500)},hideBCard:function(){this.hideBCard()}},hideBCard:function(){clearTimeout(this.bcTimeout),this.bcTimeout=setTimeout(function(){var e=document.getElementById("popoverTooltip");if(e){e.setData("ltPropShow",!1);var t=document.getElementsByClassName("userHover")[0];if(t&&t.className.indexOf("userHover")>-1){var r=t.className.split(" ");r.splice(r.indexOf("userHover"),1),t.className=r.join(" ")}}},500)},getValue:function(){for(var e=this.$node.querySelector("crux-user-dropdown").cxProp("selectedUsers"),t=[],r=0;r<e.length;r++)t.push(e[r].id);return t},valueObserver:function(){var e=this;"criteria"!=this.getData("cxPropFrom")&&"filter"!=this.getData("cxPropFrom")||store.findAll("user",this.getData("cxPropValue")).then(function(t){e.setData("selectedUsers",t)})}.observes("cxPropValue")});