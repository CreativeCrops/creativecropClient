Lyte.Component.register("crux-column-list",{_template:'<template tag-name="crux-column-list">\t<lyte-menu-body>\t\t<lyte-search lt-prop-placeholder="{{cruxGetI18n(\'crm.globalsearch.search.title\')}}" onfocus="{{action(\'setBorderColor\')}}" lt-prop-query-selector="{&quot;scope&quot; : &quot;lyteBodyPosition&quot;, &quot;target&quot; : &quot;lyte-menu-item.lyteMenuItem&quot;, &quot;search&quot; : &quot;lyte-menu-item.lyteMenuItem&quot;}" on-search="{{method(\'searchColumnList\')}}" style="width : 100%; padding: 10px 10px 10px 10px;" class="columnListSearchIcon" lt-prop-class="{{focusClass}}"></lyte-search>\t\t<div class="divTopBorder lyteBodyPosition">\t\t\t<template is="for" items="{{items}}" item="item" index="index">\t\t\t\t<template is="if" value="{{expHandlers(item.skip,\'!\')}}"><template case="true">\t\t\t\t\t<lyte-menu-item class="lyteMenuItem ccNotSelected sortable-element" onmouseover="{{action(\'showHideSortIcon\', this, true)}}" onmouseout="{{action(\'showHideSortIcon\', this)}}" onclick="{{action(\'menuClick\', item, this)}}">\t\t\t\t\t\t<lyte-checkbox on-unchecked="{{method(\'onUnchecked\', item)}}" data-value="{{item.api_name}}" lt-prop-label="{{item.field_label}}" lt-prop-type="default" lt-prop-checked="{{if(item.cxPropSelected, true, false)}}" on-checked="{{method(\'checkedCheckbox\', item)}}" on-before-unchecked="{{method(\'beforeUnchecking\', item)}}" class="columnListCheckbox"></lyte-checkbox>\t\t\t\t\t\t<span class="sortIcon"></span>\t\t\t\t\t</lyte-menu-item>\t\t\t\t</template></template>\t\t\t</template>\t\t\t<template is="if" value="{{showNoResult}}"><template case="true">\t\t\t\t<div style="text-align: center; display: block;">{{cruxGetI18n(\'crm.label.no.results.match\')}}</div>\t\t\t</template></template>\t\t</div>\t\t<div>\t\t\t<lyte-button lt-prop-appearance="primary" data-zcqa="{{cxPropPrimaryBtnZcqa}}" onclick="{{action(\'clickPrimaryBtn\')}}">\t\t\t\t<template is="registerYield" yield-name="text">{{cruxGetI18n(\'crm.button.save\')}}</template>\t\t\t</lyte-button>\t\t\t<lyte-button data-zcqa="{{cxPropSecondaryBtnZcqa}}" onclick="{{action(\'clickSecondaryBtn\')}}">\t\t\t\t<template is="registerYield" yield-name="text">{{cruxGetI18n(\'crm.button.cancel\')}}</template>\t\t\t</lyte-button>\t\t</div>\t</lyte-menu-body></template>',_dynamicNodes:[{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3,1]},{type:"for",position:[1,3,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]}},default:{}}]},{type:"attr",position:[1,3,3]},{type:"if",position:[1,3,3],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[1,5,1]},{type:"registerYield",position:[1,5,1,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[1,5,1]},{type:"attr",position:[1,5,3]},{type:"registerYield",position:[1,5,3,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[1,5,3]},{type:"componentDynamic",position:[1]}],_observedAttributes:["focusClass","cxPropAllFields","cxPropSelectedFields","showNoResult"],init:function(){for(var e=this.getData("cxPropAllFields").slice(0),t=this.getData("cxPropSelectedFields").slice(0).map(function(e){return e.id}),o=[],n=t.length,i=0;i<e.length;i++){var r=t.indexOf(e[i].id);r>-1?(e[i].cxPropSelected=!0,o[r]=e[i]):o[n++]=e[i]}this.setData({items:o})},callForSortable:function(){$L("#sortableList").sortable({onPlaceholder:function(e,t){var o,n=e.querySelector("input"),i=t.nextElementSibling;o=null!=t.previousElementSibling&&t.previousElementSibling.querySelector("input");var r=i.querySelector("input");return!(n&&!n.checked&&i&&r&&r.checked)&&(!(n&&n.checked&&i&&r&&!r.checked)||!(!o||!o.checked||r.checked))},onBeforeDrop:function(e){document.getElementById("dummy").classList.contains("lyteSortableDisabledPlaceholder")?e.changed=!0:e.changed=!1},onDrop:function(){for(var e=store.peekAll("custom_view")[0].fields.slice(0),t=$("#columnCheckbox lyte-checkbox input:checked"),o=e.length,n=0;n<o;n++)if(e[n].api_name!=t[n].id.split("-")[1])for(var i=n+1;i<o;i++)if(t[n].id.split("-")[1]==e[i].api_name){var r=Lyte.arrayUtils(e,"replaceAt",i,e[n]);Lyte.arrayUtils(e,"replaceAt",n,r)}store.peekAll("custom_view")[0].$.set("fields",e),document.querySelector("crm-column-list").component.callForSortable()}})},actions:{dragItem:function(){$("#sortableList lyte-menu-item").find("label").on("click",function(){var e=$(this),t=e.find("input");if(t.is(":disabled"))return!1;var o,n=$("#columnCheckbox lyte-checkbox input:checked").length,i=e.closest("lyte-menu-item"),r=$("#sortableList lyte-menu-item").index(i);if(t.is(":checked")){var l=n-r-1;l*=26,i.css({transform:"translateY("+l+"px)",transition:"0.3s all ease"});for(var s=r+1;s<n;s++)(o={}).transition="0.3s transform ease",o.transition="translateY(-100%)",$($("#sortableList lyte-menu-item:visible")[s]).css(o);i.one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){var e=$(this).closest("lyte-menu-item");$("#sortableList lyte-menu-item").css({transform:"",transition:""}),e.insertAfter($("#sortableList lyte-menu-item:visible")[n-1]),e.off("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend")})}else{l=r-n;l*=26,i.css({transform:"translateY(-"+l+"px)",transition:"0.3s all ease"});for(s=n;s<r;s++)(o={}).transition="0.3s transform ease",o.transition="translateY(100%)",$($("#columnListId lyte-menu-item:visible")[s]).css(o);i.one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){var e=$(this).closest("lyte-menu-item");$("#sortableList lyte-menu-item").css({transform:"",transition:""}),e.insertAfter($("#sortableList lyte-menu-item:visible")[n-1]),e.off("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend")})}})},setBorderColor:function(){this.setData("focusClass","topBarColor")},removeBorderColor:function(){this.setData("focusClass","")},saveCustomView:function(){var e=store.peekRecord("custom_view",this.getData("cvid")),t=moduleRecordMapping[this.getData("module")].api_name,o=this;e.$.save({module:t}).then(function(){store.unloadAll(moduleRecordMapping[o.getData("module")].id),document.getElementsByTagName("crm-list-view")[0].component.setData("listfields",e.fields);var n=Lyte.Router.getRouteInstance().getQueryParams(),i=n.page?n.page:1,r={module:t,cvid:o.getData("cvid"),page:i,per_page:moduleRecordMapping[o.getData("module")].per_page};store.findAll(moduleRecordMapping[o.getData("module")].id,r).then(function(e){document.getElementsByTagName("crm-list-view")[0].component.setData("customview_records",e),this.$node.querySelector("lyte-popover").ltProp("show",!1)})})},closePopover:function(){this.$node.querySelector("lyte-popover").ltProp("show",!1)},clickPrimaryBtn:function(){if(this.getMethods("onClickPrimaryBtn")){for(var e=this.getData("items"),t={},o=0;o<e.length&&e[o].cxPropSelected;o++)t[e[o].api_name]=e[o];var n=this.$node.querySelectorAll("lyte-checkbox input:checked"),i=[];for(o=0;o<n.length;o++){var r=n[o].closest("lyte-checkbox").getAttribute("data-value");i.push(t[r])}this.executeMethod("onClickPrimaryBtn",i.slice(0))}},clickSecondaryBtn:function(){this.getMethods("onClickSecondaryBtn")&&this.executeMethod("onClickSecondaryBtn")},showHideSortIcon:function(e,t){e=e.querySelector(".sortIcon"),style="none",t&&(style="block"),e.style.display=style},menuClick:function(e,t){t.querySelector("lyte-checkbox").component.setData("ltPropChecked",!e.cxPropSelected)}},methods:{columnScroll:function(){return!1},columnResize:function(){var e=document.getElementById("addColumn"),t=document.querySelector(".addColumnPopover .lytePopover"),o=document.querySelector(".divBorder"),n=e.getBoundingClientRect().left,i=e.getBoundingClientRect().bottom,r=window.innerHeight-(i+30)+"px",l=document.getElementById("lytePopoverFooter").getBoundingClientRect().top-55-e.getBoundingClientRect().bottom,s=document.querySelector(".addColumnPopover .lytePopover lyte-popover-content"),a=document.querySelector(".addColumnPopover .lytePopover lyte-popover-header").getBoundingClientRect().height,c=document.querySelector(".addColumnPopover .lytePopover lyte-popover-footer").getBoundingClientRect().height;t.style.left=n+"px",t.style.top=i+"px",document.querySelector("crm-column-list lyte-popover").ltProp("maxHeight",r),s.style.height=parseInt(r)-(a+c)-30+"px",o.style.maxHeight=l+"px",o.style.borderBottom="1px solid #eee",o.style.borderTop="1px solid #eee",o.style.overflow="auto"},makeSortable:function(){var e=document.getElementById("addColumn"),t=document.querySelector(".addColumnPopover .lytePopover"),o=e.getBoundingClientRect().left,n=e.getBoundingClientRect().bottom;t.style.left=o+"px",t.style.top=n+"px",this.callForSortable(),setTimeout(function(){document.getElementById("toGetSearch").querySelector("input").focus()},21)},beforePopoverShow:function(){var e=document.getElementById("addColumn"),t=Utils.windowHeight-30,o=document.querySelector(".divBorder");document.querySelector("crm-column-list lyte-popover").ltProp("maxHeight",t-e.getBoundingClientRect().bottom-30+"px");var n=t-154-e.getBoundingClientRect().bottom;o.style.maxHeight=n+"px",o.style.borderBottom="1px solid #eee",o.style.borderTop="1px solid #eee",o.style.overflow="auto"},closePopover:function(){store.peekAll("custom_view")[0].$.rollBack(),this.callForArrangement(this),this.$node.querySelector("lyte-popover").ltProp("show",!1)},beforeUnchecking:function(e){return!e.mandatory||!this.getMethods("onBeforeUncheckingMandatoryField")||this.executeMethod("onBeforeUncheckingMandatoryField",e)},onUnchecked:function(e){var t=arguments[1].closest("lyte-menu-item");if(t.sorted)return t.sorted=!1,arguments[1].checked=!0,!1;e.cxPropSelected=!1;var o=this.$node.querySelectorAll("lyte-checkbox input:checked"),n=o.length,i=Array.prototype.slice.call(this.$node.querySelectorAll("lyte-menu-item")).indexOf(t),r=40*(n-i);t.style.transition="0.3s all ease",t.style.transform="translateY("+r+"px)";var l=this;t.addEventListener("webkitTransitionEnd",function(e){if(!e.currentTarget.dataset.triggered){e.currentTarget.dataset.triggered=!0,t.style.transition="",t.style.transform="";var n=Lyte.arrayUtils(l.getData("items"),"removeAt",i,1)[0];Lyte.arrayUtils(l.getData("items"),"insertAt",o.length,n)}})},checkedCheckbox:function(e){var t=arguments[1].closest("lyte-menu-item");if(t.sorted)return t.sorted=!1,arguments[1].checked=!1,!1;e.cxPropSelected=!0;var o=this.$node.querySelectorAll("lyte-checkbox input:checked"),n=o.length-1,i=Array.prototype.slice.call(this.$node.querySelectorAll("lyte-menu-item")).indexOf(t),r=40*(i-n);t.style.transition="0.3s all ease",t.style.transform="translateY(-"+r+"px)";var l=this;t.addEventListener("webkitTransitionEnd",function(e){if(!e.currentTarget.dataset.triggered){e.currentTarget.dataset.triggered=!0,t.style.transition="",t.style.transform="";var n=o.length-2,r=Lyte.arrayUtils(l.getData("items"),"removeAt",i,1)[0];n>=0?Lyte.arrayUtils(l.getData("items"),"insertAt",n+1,r):Lyte.arrayUtils(l.getData("items"),"insertAt",0,r)}}),event.stopPropagation()},searchColumnList:function(e){this.setData("showNoResult",0==e.length)}},didConnect:function(){var e=this.$node.querySelector(".divTopBorder");e.style.minHeight=e.offsetHeight+"px";var t=this;$L(e).sortable({onBeforeDrop:function(e,o,n,i,r){var l=t.$node.querySelectorAll("lyte-checkbox input:checked");if(e.sorted=!0,0!=l.length&&i!=r)if(e.querySelector("input").checked){if(l.length>r)return!0}else if(r>=l.length)return!0;return!1}})},data:function(){return{focusClass:Lyte.attr("string",{default:""}),cxPropAllFields:Lyte.attr("array"),cxPropSelectedFields:Lyte.attr("array",{default:[]}),showNoResult:Lyte.attr("boolean",{default:!1})}}});var UID={_current:0,getNew:function(){return this._current++,this._current}};HTMLElement.prototype.pseudoStyle=function(e,t,o){var n=document.head||document.getElementsByTagName("head")[0],i=document.getElementById("pseudoStyles")||document.createElement("style");i.id="pseudoStyles";var r="pseudoStyle"+UID.getNew();return this.className+=" "+r,i.innerHTML+=" ."+r+":"+e+"{"+t+":"+o+"}",n.appendChild(i),this};