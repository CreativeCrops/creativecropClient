Lyte.Component.register("crux-criteria-editor",{_template:'<template tag-name="crux-criteria-editor">\t<template is="if" value="{{expHandlers(cxPropType,\'==\',\'create\')}}"><template case="true">\t\t<lyte-alert lt-prop-type="warning" id="patternWarning"></lyte-alert>\t\t<div class="pwie">\t\t\t<div id="criteriaDiv">\t\t\t\t<lyte-table lt-prop-yield="true" id="criteriaTable" lt-prop-prevent-scrollbar="true">\t\t\t\t<template is="registerYield" yield-name="yield">\t\t\t\t     <lyte-table-structure>\t\t\t\t        <lyte-tbody>\t\t\t\t           <lyte-tr>\t\t\t\t                <lyte-td>\t\t\t\t                \t<div>\t\t\t\t                \t\t<lyte-table lt-prop-yield="true" id="searchlayer_new" class="newApCriteriaTable newCriUi newSrchView">\t\t\t\t\t\t\t\t\t\t<template is="registerYield" yield-name="yield">\t\t\t\t\t\t\t\t\t\t     <lyte-table-structure>\t\t\t\t\t\t\t\t\t\t        <lyte-tbody class="criteriaHeader" id="{{totalCriteria}}">\t\t\t\t\t\t\t\t\t\t        \t<template is="for" items="{{arr}}" item="val" index="index">\t\t\t\t\t\t\t\t\t\t           <lyte-tr id="searchcrt{{add(index,1)}}" class="searchcrt" data-index="1">\t\t\t\t\t\t\t\t\t\t                <crux-criteria-editor-header id="criteriaEditorHeader{{add(index,1)}}" module="{{cxPropModule}}" on-operator-change-call="{{method(\'onOperatorChangeCall\')}}" criteria-array-object-update="{{method(\'criteriaArrayObjectUpdate\')}}" on-field-change-call="{{method(\'onFieldChangeCall\')}}" and-or-condition="{{patternArrDis[index]}}" criteria-index="{{add(index,1)}}" show-add="{{if(ifEquals(arr.length, add(index,1)), true, false)}}" show-remove="{{if(ifEquals(arr.length,1), false, true)}}" fields="{{cxPropFields}}" tags="{{tags}}" layout="{{layout}}" set-criteria-obj="{{unbound(if(setCriteriaObj[index],setCriteriaObj[index]))}}" remove-pattern="{{cxPropRemovePattern}}"></crux-criteria-editor-header>\t\t\t\t\t\t\t\t\t\t            </lyte-tr>     \t\t\t\t\t\t\t\t\t\t\t        \t</template>\t\t\t\t\t\t\t\t\t\t        \t<template is="if" value="{{expHandlers(expHandlers(arr.length,\'>\',1),\'&amp;&amp;\',expHandlers(cxPropRemovePattern,\'!\'))}}"><template case="true">\t\t\t\t\t\t\t\t\t\t            <lyte-tr>\t\t\t\t\t\t\t\t\t\t            <div class="w100per oH new_pat_edtr gBB" id="changePattern">\t\t\t\t\t\t\t\t\t\t            <lyte-td></lyte-td>\t\t\t\t\t\t\t\t\t\t            <lyte-td>\t\t\t\t\t\t\t\t\t\t            \t<span class="wf_form_lab dIB vam">{{cruxGetI18n("crm.label.criteria.pattern")}}</span>\t\t\t\t\t\t\t\t\t\t            </lyte-td>\t\t\t\t\t\t\t\t\t\t            <lyte-td>\t\t\t\t\t\t\t\t\t            \t\t\t<lyte-input lt-prop-disabled="{{if(ifEquals(showEdit,true), false, true)}}" lt-prop-height="40px" lt-prop-text-area-resize="{}" lt-prop-type="textarea" class="criteriaPatternText" lt-prop-value="{{lbind(criteria)}}" lt-prop-id="lyteInputCriteria" lt-prop-rows="5" lt-prop-cols="60"></lyte-input>\t\t\t\t\t\t\t\t\t\t            </lyte-td>\t\t\t\t\t\t\t\t\t\t            <lyte-td>\t\t\t\t\t\t\t\t\t\t\t            \t<template is="if" value="{{expHandlers(showEdit,\'!\')}}"><template case="true">\t\t\t\t\t\t\t\t\t\t\t            \t<span style="padding: 5px; cursor:pointer; color: blue" onclick="{{action(\'openEditCriteria\')}}">{{cruxGetI18n("crm.label.edit.criteria.pattern")}}</span>\t\t\t\t\t\t\t\t\t\t\t            \t</template><template case="false">\t\t\t\t\t\t\t\t\t\t\t            \t<span style="padding: 5px; cursor:pointer;  color: blue" onclick="{{action(\'saveCriteriaPattern\')}}">{{cruxGetI18n("crm.button.save")}}</span>\t\t\t\t\t\t\t\t\t\t\t            \t<span style="padding: 5px; cursor:pointer;" onclick="{{action(\'closeEditCriteria\')}}">{{cruxGetI18n("crm.button.cancel")}}</span>\t\t\t\t\t\t\t\t\t\t\t            \t</template></template>\t\t\t\t\t\t\t\t\t\t            </lyte-td>\t\t\t\t\t\t\t\t\t\t            </div></lyte-tr></template></template>\t\t\t\t\t\t\t\t\t\t             \t\t\t\t\t\t\t\t\t\t            \t\t\t\t\t\t\t  \t\t\t        </lyte-tbody> \t\t\t\t\t\t\t\t\t\t     </lyte-table-structure>\t\t\t\t\t\t\t\t\t\t </template> \t\t\t\t\t\t\t\t\t</lyte-table>\t\t\t\t                \t</div>\t\t\t\t                 </lyte-td>\t\t\t\t            </lyte-tr> \t  \t\t\t        </lyte-tbody> \t\t\t\t     </lyte-table-structure>\t\t\t\t </template> \t\t\t</lyte-table>\t\t\t</div>\t\t</div>\t</template></template><template is="if" value="{{expHandlers(cxPropType,\'==\',\'view\')}}"><template case="true">\t\t<div class="pwie">\t\t\t<div id="criteriaDiv">\t\t\t\t<lyte-table lt-prop-yield="true" id="criteriaTable">\t\t\t\t<template is="registerYield" yield-name="yield">\t\t\t\t     <lyte-table-structure>\t\t\t\t        <lyte-tbody>\t\t\t\t           <lyte-tr>\t\t\t\t                <lyte-td>\t\t\t\t                \t<div>\t\t\t\t                \t\t<lyte-table lt-prop-yield="true" id="searchlayer_new" class="newApCriteriaTable newCriUi newSrchView">\t\t\t\t\t\t\t\t\t\t<template is="registerYield" yield-name="yield">\t\t\t\t\t\t\t\t\t\t     <lyte-table-structure>\t\t\t\t\t\t\t\t\t\t        <lyte-tbody class="criteriaHeader" id="{{totalCriteria}}">\t\t\t\t\t\t\t\t\t\t        \t<template is="for" items="{{arr}}" item="val" index="index">\t\t\t\t\t\t\t\t\t\t\t        \t <lyte-tr id="searchcrt{{add(index,1)}}" class="searchcrt" data-index="1">\t\t\t\t\t\t\t\t\t\t                <crux-criteria-editor-view-header id="criteriaEditorHeader{{add(index,1)}}" module="{{cxPropModule}}" criteria-index="{{add(index,1)}}" and-or-condition="{{patternArrDis[index]}}" fields="{{cxPropFields}}" criteria="{{unbound(if(setCriteriaObj[index],setCriteriaObj[index]))}}" remove-pattern="{{cxPropRemovePattern}}"></crux-criteria-editor-view-header>\t\t\t\t\t\t\t\t\t\t            </lyte-tr> \t\t\t\t\t        \t\t\t\t\t\t\t\t\t\t\t        \t</template>\t\t\t\t\t\t\t\t\t\t        \t<template is="if" value="{{expHandlers(arr.length,\'>\',1)}}"><template case="true">\t\t\t\t\t\t\t\t\t\t            <lyte-tr>\t\t\t\t\t\t\t\t\t\t            <div class="w100per oH new_pat_edtr gBB" id="changePattern">\t\t\t\t\t\t\t\t\t\t            <lyte-td></lyte-td>\t\t\t\t\t\t\t\t\t\t            <lyte-td>\t\t\t\t\t\t\t\t\t\t            \t<span class="wf_form_lab dIB vam">{{cruxGetI18n("crm.label.criteria.pattern")}}</span>\t\t\t\t\t\t\t\t\t\t            </lyte-td>\t\t\t\t\t\t\t\t\t\t            <lyte-td>\t\t\t\t\t\t\t\t\t            \t\t\t<lyte-input lt-prop-disabled="true" lt-prop-height="40px" lt-prop-text-area-resize="{}" class="criteriaPatternText" lt-prop-id="lyteInputCriteria" lt-prop-rows="5" lt-prop-value="{{lbind(criteria)}}" lt-prop-cols="60"></lyte-input>\t\t\t\t\t\t\t\t\t\t            </lyte-td>\t\t\t\t\t\t\t\t\t\t            </div></lyte-tr></template></template>\t\t\t\t\t\t\t\t\t\t             \t\t\t\t\t\t\t\t\t\t            \t\t\t\t\t\t\t  \t\t\t        </lyte-tbody> \t\t\t\t\t\t\t\t\t\t     </lyte-table-structure>\t\t\t\t\t\t\t\t\t\t </template> \t\t\t\t\t\t\t\t\t</lyte-table>\t\t\t\t                \t</div>\t\t\t\t                 </lyte-td>\t\t\t\t            </lyte-tr> \t  \t\t\t        </lyte-tbody> \t\t\t\t     </lyte-table-structure>\t\t\t\t </template> \t\t\t</lyte-table>\t\t\t</div>\t\t</div>\t</template></template></template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"componentDynamic",position:[1]},{type:"registerYield",position:[3,1,1,1],dynamicNodes:[{type:"registerYield",position:[1,1,1,1,1,1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"attr",position:[1,1,1]},{type:"for",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"attr",position:[1,1,3]},{type:"if",position:[1,1,3],cases:{true:{dynamicNodes:[{type:"componentDynamic",position:[1,1,1]},{type:"text",position:[1,1,3,1,0]},{type:"componentDynamic",position:[1,1,3]},{type:"attr",position:[1,1,5,1]},{type:"componentDynamic",position:[1,1,5,1]},{type:"componentDynamic",position:[1,1,5]},{type:"attr",position:[1,1,7,1]},{type:"if",position:[1,1,7,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]},{type:"attr",position:[3]},{type:"text",position:[3,0]}]}},default:{}},{type:"componentDynamic",position:[1,1,7]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,1,1,1,1,1]},{type:"componentDynamic",position:[1,1,1,1]},{type:"componentDynamic",position:[1,1,1]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[3,1,1]}]}},default:{}},{type:"attr",position:[2]},{type:"if",position:[2],cases:{true:{dynamicNodes:[{type:"registerYield",position:[1,1,1,1],dynamicNodes:[{type:"registerYield",position:[1,1,1,1,1,1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"attr",position:[1,1,1]},{type:"for",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"attr",position:[1,1,3]},{type:"if",position:[1,1,3],cases:{true:{dynamicNodes:[{type:"componentDynamic",position:[1,1,1]},{type:"text",position:[1,1,3,1,0]},{type:"componentDynamic",position:[1,1,3]},{type:"attr",position:[1,1,5,1]},{type:"componentDynamic",position:[1,1,5,1]},{type:"componentDynamic",position:[1,1,5]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,1,1,1,1,1]},{type:"componentDynamic",position:[1,1,1,1]},{type:"componentDynamic",position:[1,1,1]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,1,1]}]}},default:{}}],_observedAttributes:["cxPropFields","totalCriteria","cxPropModule","arr","patternArr","showEdit","criteria","patternArrDis","bufferCriteria","shownAlert","criteriaArrayObject","cxPropSetCriteria","setCriteriaObj","moduleId","cxPropType","response","setCriteriaViewObj","getFields","cxPropMaxCount","cxPropRemovePattern","cxPropSpecifiedCondition","defaultCondition","defaultLabelCondition"],data:function(){return{cxPropFields:Lyte.attr("array"),totalCriteria:Lyte.attr("number",{default:1}),cxPropModule:Lyte.attr("string"),arr:Lyte.attr("array",{default:[1]}),patternArr:Lyte.attr("array",{default:[" "]}),showEdit:Lyte.attr("boolean",{default:!1}),criteria:Lyte.attr("string",{default:"1"}),patternArrDis:Lyte.attr("array",{default:[" "]}),bufferCriteria:Lyte.attr("string"),shownAlert:Lyte.attr("boolean",{default:!1}),criteriaArrayObject:Lyte.attr("array",{default:[]}),cxPropSetCriteria:Lyte.attr("object"),setCriteriaObj:Lyte.attr("array"),moduleId:Lyte.attr("string"),cxPropType:Lyte.attr("string",{default:"create"}),response:Lyte.attr("string",{default:"new"}),setCriteriaViewObj:Lyte.attr("array"),getFields:Lyte.attr("boolean",{default:!1}),cxPropMaxCount:Lyte.attr("number",{default:25}),cxPropRemovePattern:Lyte.attr("boolean",{default:!1}),cxPropSpecifiedCondition:Lyte.attr("string"),defaultCondition:Lyte.attr("string",{default:_cruxUtils.getI18n("and")}),defaultLabelCondition:Lyte.attr("string",{default:_cruxUtils.getI18n("crm.label.and")})}},didConnect:function(){this.onGetFieldsSucess()},getFieldsList:function(){function t(t,e){const i=t.field_label,a=e.field_label;let r=0;return i>a?r=1:i<a&&(r=-1),r}var e=this;if(void 0==this.getData("cxPropFields")){if(this.getData("cxPropModule"))if(this.setData("moduleId",moduleRecordMapping[this.getData("cxPropModule")].id),store.peekRecord("module",this.getData("moduleId")).fields){var i=store.peekRecord("module",this.getData("moduleId")).fields;this.getMethods("onFieldConstruction")&&(i=this.executeMethod("onFieldConstruction",i)),this.setData("cxPropFields",i.sort(t)),this.setData("getFields",!0),this.onGetFieldsSucess()}else store.findRecord("module",this.getData("moduleId")).then(function(i){var a;a=e.getMethods("onFieldConstruction")?e.executeMethod("onFieldConstruction",i[0].fields):i[0].fields,e.setData("cxPropFields",a.sort(t)),e.setData("getFields",!0),e.onGetFieldsSucess()})}else this.setData("cxPropFields",this.getData("cxPropFields").sort(t)),e.setData("getFields",!0)},onGetFieldsSucess:function(){this.getData("getFields")&&this.getData("cxPropSetCriteria")&&this.setCriteria(this.getData("cxPropSetCriteria"))},init:function(){this.getData("cxPropSpecifiedCondition")&&("and"==this.getData("cxPropSpecifiedCondition")?(this.setData("defaultCondition",_cruxUtils.getI18n("and")),this.setData("defaultLabelCondition",_cruxUtils.getI18n("crm.label.and"))):"or"==this.getData("cxPropSpecifiedCondition")&&(this.setData("defaultCondition",_cruxUtils.getI18n("or")),this.setData("defaultLabelCondition",_cruxUtils.getI18n("crm.label.or"))),this.setData("cxPropRemovePattern",!0)),this.getFieldsList(),this.$node.getCriteria=function(){return this.component.getCriteria()}},validatePattern:function(t,e,i){e=void 0!==e?e:"";var a=(t=t.replace(/#/g,"~")).match(/\(/gi);if(a)var r=a.length;var o=t.match(/\)/gi);if(o)var n=o.length;if(r!=n)return this.showAlert(_cruxUtils.getI18n("criteria.error.alert.brackets.count.mismatch")),this.setData("shownAlert",!0),!1;var s=t.replace(/(and|or)/g,"#").split(" ").join("").replace(/\n/g,"");if(-1!=s.indexOf("(#")||-1!=s.indexOf("#)"))return this.showAlert(_cruxUtils.getI18n("criteria.error.alert.brackets.invalid")),this.setData("shownAlert",!0),!1;if(-1!=s.indexOf("()"))return this.showAlert(_cruxUtils.getI18n("criteria.error.alert.brackets.invalid")),this.setData("shownAlert",!0),!1;var l=s.replace(/[()]/g,"#"),c=t.match(/[0-9]+/g);if(null!=c)for(var d=c.length,p=0;p<d;p++)if(c[p]!=p+1)return this.showAlert(_cruxUtils.getI18n("crm.criteria.number.notmatch.check",c[p])),this.setData("shownAlert",!0),!1;var y=l.replace(/[0-9]+/g,"#").replace(/#/g,"");if(y&&y.length>=1)return this.showAlert(_cruxUtils.getI18n("criteria.error.alert.other.params")),this.setData("shownAlert",!0),!1;var u=t.match(/(and|or)/gi);return i=i||Search["rowcnt"+e],u&&i-1!==u.length?(this.showAlert(_cruxUtils.getI18n("criteria.error.alert.andor.rowcount.mismatch")),this.setData("shownAlert",!0),!1):i!=l.replace(/[0-9]+/g,"$").replace(/#/g,"").length?(this.showAlert(_cruxUtils.getI18n("criteria.error.alert.critnum.rowcount.mismatch")),this.setData("shownAlert",!0),!1):t=(t=this.addSpaceBetweenParanthesis(t)).replace(/\n/g,"")},savePattern:function(t,e,i,a){t=void 0!==t?t:"";var r=e,o=a.split(" ").join("");return!!(o=this.validatePattern(o,t,r))&&(o.replace(new RegExp("and","g"),_cruxUtils.getI18n("and")).replace(new RegExp("or","g"),_cruxUtils.getI18n("or")),this.updateCriteriaRowsBasedOnChangedPattern(o),o)},updateCriteriaRowsBasedOnChangedPattern:function(t){for(var e=[" "],i=t.match(/(and|or)/gi),a=[" "],r=i.length,o=0;o<r;o++)e.push(i[o]),i[o]==_cruxUtils.getI18n("or")?a.push(_cruxUtils.getI18n("crm.label.or")):i[o]==_cruxUtils.getI18n("and")&&a.push(_cruxUtils.getI18n("crm.label.and"));this.setData("patternArr",e),this.setData("patternArrDis",a)},criteriaOption:function(t,e){var i=this.getData("patternArr"),a=this.getData("criteria");if("add"==t)a="("+a+i[e-1]+e+")";else if("remove"==t){var r=0,o=e+" ";a=(a=a.replace(/(and|or)/g,"#")).replace(/#/g,function(t){return++r===(1!=e?e-1:e)?"":t});var n=new RegExp(o,"g");r=0,a=(a=a.replace(n,"")).replace(/#/g,function(t){return++r<=i.length?i[r]:t}),r=1,a=(a=(a=a.replace(/[0-9]/g,"#")).replace(/##/g,"#")).replace(/#/g,function(t){return r<=a.match(/#/g).length?r++:t})}else"mod"==t&&(r=0,a=(a=a.replace(/(and|or)/g,"#")).replace(/#/g,function(t){return++r<=i.length?i[r]:t}));for(a=a.replace(/ /g,"");a.match(/\(\)/g,"");)a=a.replace(/\(\)/g,"");a=this.addSpaceBetweenParanthesis(a),this.setData("criteria",a)},showAlert:function(t){var e=!0;if(this.getMethods("onBeforeErrorAlert")&&(e=this.executeMethod("onBeforeErrorAlert",t)),e){var i=this.$node.querySelector("#patternWarning");i.ltProp("primaryMessage",t),i.ltProp("heading","Warning Alert"),i.ltProp("show",!0),this.getMethods("onErrorAlert")&&this.executeMethod("onErrorAlert",t)}},checkValuesCondition:function(){for(var t=this.getData("criteriaArrayObject"),e=t.length,i=1;i<e;i++){for(var a,r=t[i],o=0;o<this.getData("cxPropFields").length;o++)if(r.api_name==this.getData("cxPropFields")[o].api_name){a=this.getData("cxPropFields")[o].field_label;break}if(""==r.api_name||"None"==r.api_name||null==r.api_name)return this.showAlert(_cruxUtils.getI18n("crm.criteria.fieldlabel.valid.check",i)),!1;if(""==r.comparator||"None"==r.comparator||null==r.api_name)return this.showAlert(_cruxUtils.getI18n("crm.criteria.condition.valid.check",a)),!1;if(""==r.value||null==r.api_name)return this.showAlert(_cruxUtils.getI18n("crm.field.valid.check",a)),!1;if(r.comparator.match(/between/)&&r.value[0]>r.value[1])return this.showAlert(_cruxUtils.getI18n("crm.custom.field.less.than.to")),!1}return!0},getCriteria:function(){for(var t=0;t<this.getData("totalCriteria");t++)this.$node.getElementsByTagName("crux-criteria-editor-header")[t].component.getValue();var e=this.getData("criteriaArrayObject");if(this.checkValuesCondition()){if("new"==this.getData("response")){var i=e,a=this.getData("criteria");a=(a=(a=(a=a.replace(/ /g,"")).replace(/and/g,"+").replace(/or/g,"-")).replace(/[0-9]/g,"#")).replace(/##/g,"#");for(var r=[],o=[],n=[],s=(t=0,1);t<a.length;t++)if("("==a[t])r.push(a[t]);else if("+"==a[t]||"-"==a[t])o.push(a[t]);else if(")"==a[t]){if(n.length>1){r.pop();var l=[];l.push(n.pop()),l.push(n.pop()),l.reverse();var c=o.pop();"+"==c?c="and":"-"==c&&(c="or"),n.push({group_operator:c,group:l})}}else n.push(i[s++]);n=n[0]}else{var d=0;n="["+(i=(i=(i=(i=(i=(i=this.getData("criteria")).replace(/\( /g,"[").replace(/ \)/g,"]")).replace(/ and /g,',"and",').replace(/ or /g,',"or",')).replace(/[0-9]/g,"#")).replace(/##/g,"#")).replace(/#/g,function(t){return++d<=e.length?JSON.stringify(e[d]):t}))+"]"}return this.setData("setCriteriaObj",this.getData("criteriaArrayObject")),Lyte.arrayUtils(this.getData("setCriteriaObj"),"removeAt",0),n}},inorder:function(t,e){return null!==t&&(null!=t.left&&(e+="("),e=this.inorder(t.left,e),e+=t.value,e=this.inorder(t.right,e),null!=t.right&&(e+=")")),e},setCriteria:function(t){if(this.setData("arr",[]),this.setData("patternArrDis",[" "]),this.setData("patternArr",[" "]),JSON.stringify(t),"new"==this.getData("response")){var e=new function t(e,i,a){e.group_operator?(this.value=e.group_operator,i.push(e.group_operator),this.left=new t(e.group[0],i,a),this.right=new t(e.group[1],i,a)):(a.push(e),this.value=a.length,this.left=null,this.right=null),this.andOr=i,this.criteria=a}(t,[],[]);s=this.inorder(e,"");var i=e.andOr;this.setData("setCriteriaObj",e.criteria),this.setData("criteria",this.changeToInternational(s)),this.setData("totalCriteria",e.criteria.length)}else{i=t.match(/("and"|"or")/g);var a=this.getCriteriaPattern(t);this.setData("criteria",a[0]),this.setData("setCriteriaObj",a[1]),this.setData("totalCriteria",a[2])}if(null!=i)for(var r=i.length,o=0;o<r;o++)i[o]=i[o].replace(/"/g,""),i[o]==_cruxUtils.getI18n("and")?(Lyte.arrayUtils(this.getData("patternArrDis"),"push",_cruxUtils.getI18n("crm.label.and")),Lyte.arrayUtils(this.getData("patternArr"),"push",_cruxUtils.getI18n("and"))):i[o]==_cruxUtils.getI18n("or")&&(Lyte.arrayUtils(this.getData("patternArrDis"),"push",_cruxUtils.getI18n("crm.label.or")),Lyte.arrayUtils(this.getData("patternArr"),"push",_cruxUtils.getI18n("or")));for(o=0;o<this.getData("totalCriteria");o++)Lyte.arrayUtils(this.getData("arr"),"push",o+1)},changeToInternational:function(t){return pattern=t.replace(/AND|OR/g,function(t){return"AND"==t?_cruxUtils.getI18n("and"):"OR"==t?_cruxUtils.getI18n("or"):void 0}),this.addSpaceBetweenParanthesis(pattern)},addSpaceBetweenParanthesis:function(t){for(var e="",i=(t=t.replace(/\s/g,"")).length,a=0;a<i;a++){var r=t.charAt(a);"("==r||"d"==r||"r"==r?e=e+r+" ":")"==r||"a"==r||"o"==r?e=e+" "+r:e+=r}return e},actions:{createNewCriteria:function(){var t=!0,e=this.getData("totalCriteria");this.getMethods("onBeforeAddCriteria")&&(t=this.executeMethod("onBeforeAddCriteria",e+1)),t&&(this.getData("showEdit")?this.showAlert(_cruxUtils.getI18n("crm.alert.label.savepattern")):e>=this.getData("cxPropMaxCount")?this.showAlert(_cruxUtils.getI18n("crm.criteria.max.rowcnt.exceeds")):(Lyte.arrayUtils(this.getData("patternArrDis"),"push",this.getData("defaultLabelCondition")),e+=1,Lyte.arrayUtils(this.getData("patternArr"),"push",this.getData("defaultCondition")),Lyte.arrayUtils(this.getData("arr"),"push",e),this.setData("totalCriteria",e),this.criteriaOption("add",e),this.getMethods("onAddCriteria")&&this.executeMethod("onAddCriteria",e)))},removeCriteria:function(t){var e=!0,i=this.getData("totalCriteria");this.getMethods("onBeforeDeleteCriteria")&&(e=this.executeMethod("onBeforeDeleteCriteria",i)),e&&(this.getData("showEdit")?this.showAlert(_cruxUtils.getI18n("crm.alert.label.savepattern")):(i-=1,this.setData("totalCriteria",i),Lyte.arrayUtils(this.getData("patternArrDis"),"removeAt",1!=t?t-1:t),Lyte.arrayUtils(this.getData("patternArr"),"removeAt",1!=t?t-1:t),Lyte.arrayUtils(this.getData("arr"),"removeAt",t-1),Lyte.arrayUtils(this.getData("criteriaArrayObject"),"removeAt",t),this.getData("setCriteriaObj")&&this.getData("setCriteriaObj")[1!=t?t-1:t]&&Lyte.arrayUtils(this.getData("setCriteriaObj"),"removeAt",1!=t?t-1:t),this.criteriaOption("remove",t),this.getMethods("onDeleteCriteria")&&this.executeMethod("onDeleteCriteria",i+1)))},openEditCriteria:function(){var t=!0;this.getMethods("onBeforeEditPattern")&&(t=this.executeMethod("onBeforeEditPattern",this.getData("criteria"))),t&&(this.setData("bufferCriteria",this.getData("criteria")),this.setData("showEdit",!0),this.getMethods("onEditPattern")&&this.executeMethod("onEditPattern",this.getData("criteria")))},closeEditCriteria:function(){var t=this.getData("criteria");this.setData("criteria",this.getData("bufferCriteria")),this.setData("showEdit",!1),this.getMethods("onCancelPattern")&&this.executeMethod("onCancelPattern",t)},saveCriteriaPattern:function(){var t=!0;if(this.getMethods("onBeforeSavePattern")&&(t=this.executeMethod("onBeforeSavePattern",this.getData("criteria"))),t){var e=this.getData("criteria"),i=this.savePattern("",this.getData("totalCriteria"),!0,e);this.getData("shownAlert")?this.setData("shownAlert",!1):(this.setData("criteria",i),this.setData("showEdit",!1)),this.getMethods("onSavePattern")&&this.executeMethod("onSavePattern",this.getData("criteria"))}},changeAndOr:function(t,e){var i,a,r=!0;this.getMethods("onBeforeConditionChange")&&(r=this.executeMethod("onBeforeConditionChange",e,t)),r&&(t==_cruxUtils.getI18n("crm.label.or")?(a=_cruxUtils.getI18n("crm.label.and"),i=_cruxUtils.getI18n("and")):t==_cruxUtils.getI18n("crm.label.and")&&(i=_cruxUtils.getI18n("or"),a=_cruxUtils.getI18n("crm.label.or")),Lyte.arrayUtils(this.getData("patternArr"),"replaceAt",e-1,i),Lyte.arrayUtils(this.getData("patternArrDis"),"replaceAt",e-1,a),this.criteriaOption("mod",e),this.getMethods("onConditionChange")&&this.executeMethod("onConditionChange",e,t))}},methods:{onFieldChangeCall:function(){this.getMethods("onFieldChange")&&this.executeMethod("onFieldChange",arguments[0],arguments[1])},onOperatorChangeCall:function(){this.getMethods("onOperatorChange")&&this.executeMethod("onOperatorChange",arguments[0],arguments[1])},criteriaArrayObjectUpdate:function(t,e){var i=this.getData("criteriaArrayObject");i[e]=t,this.setData("criteriaArrayObject",i)}},setCriteriaObserver:function(){this.onGetFieldsSucess()}.observes("cxPropSetCriteria"),moduleObserver:function(){this.getFieldsList()}.observes("cxPropModule")},{mixins:["crux-criteria-util"]}),Lyte.Component.register("crux-criteria-editor-header",{_template:'<template tag-name="crux-criteria-editor-header"><div class="header"><lyte-td style="opacity:1;">       \t\t\t\t<div class="patternNumDiv" style="height: auto; opacity: 1; overflow: visible;">       \t\t\t\t\t<template is="if" value="{{expHandlers(ifNotEquals(criteriaIndex,1),\'&amp;&amp;\',expHandlers(removePattern,\'!\'))}}"><template case="true">\t\t       \t\t\t\t<div class="andOr" style="opacity: 1; height: auto;">\t\t       \t\t\t\t\t<lyte-input lt-prop-style="color:blue;cursor:pointer; transform:scale(0.75)" lt-prop-readonly="true" lt-prop-value="{{andOrCondition}}" onclick="{{action(\'changeAndOr\')}}"></lyte-input>\t\t       \t\t\t\t</div>\t       \t\t\t\t</template></template>               \t\t\t<input type="hidden" id="match" value="">               \t\t\t<input type="text" id="patternNum" class="patterNum" value="{{criteriaIndex}}" readonly="">               \t\t</div>                </lyte-td>                <lyte-td>       \t\t\t\t<div class="patternNumDiv" style="height: auto; opacity: 1; overflow: visible;">\t\t\t\t\t\t<div class="dropdownDiv">\t\t\t\t\t\t\t<lyte-dropdown class="gBB fields" lt-prop-yield="true" lt-prop-tabindex="1" on-option-selected="{{method(\'changeField\')}}" on-show="{{method(\'onFieldDropdownShow\')}}">\t\t\t\t\t\t\t\t<template is="registerYield" yield-name="yield">\t\t\t\t\t\t\t\t\t<lyte-drop-box>\t\t\t\t\t\t\t\t\t\t<template is="if" value="{{expHandlers(fields.length,\'>\',9)}}"><template case="true">\t\t\t\t\t\t\t\t\t\t\t<lyte-drop-header>\t\t\t\t\t\t\t\t \t\t\t\t<lyte-search id="fieldSearchBox" onfocus="{{action(\'onFocusFieldSearch\', event, this)}}" onfocusout="{{action(\'onFocusOutFieldSearch\', event, this)}}" class="fieldSearchStyle{{criteriaIndex}}" lt-prop-style="padding-left:8px" lt-prop-placeholder="{{cruxGetI18n(\'crm.globalsearch.search.title\')}}" lt-prop-query-selector="{&quot;scope&quot;:&quot;.lyteFieldsDropbody{{criteriaIndex}}&quot;,&quot;search&quot;:&quot;lyte-drop-item:not(.prevent)&quot;, &quot;target&quot; : &quot;lyte-drop-item:not(.prevent)&quot;}" style="width:100%" on-search="{{method(&quot;onFieldSearch&quot;)}}" lt-prop-appearance="box"> \t\t\t\t\t\t\t\t\t\t\t\t</lyte-search> \t\t\t\t\t\t\t\t\t\t\t</lyte-drop-header>\t\t\t\t\t\t\t\t\t\t</template></template>\t\t\t\t\t\t\t\t\t\t<lyte-drop-body class="lyteFieldsDropbody{{criteriaIndex}}">\t\t\t\t\t\t\t\t\t\t\t<lyte-drop-item class="selector{{criteriaIndex}}" data-value="-1" id="none" value="{{cruxGetI18n(\'None\')}}">\t\t\t\t\t\t\t\t\t\t\t<span class="{{if(ifEquals(criteriaArray.api_name,cruxGetI18n(\'None\')),\'selectedTick\',\'\')}}"></span>\t\t\t\t\t\t\t\t\t\t\t{{cruxGetI18n(\'None\')}}\t\t\t\t\t\t\t\t\t\t\t</lyte-drop-item>\t\t\t\t\t\t\t\t\t\t\t<template is="for" items="{{fields}}" item="item" index="index">\t\t\t\t\t\t\t\t\t\t\t\t<lyte-drop-item class="selector{{criteriaIndex}}" data-value="{{index}}" id="{{item.data_type}}" value="{{item.api_name}}">\t\t\t\t\t\t\t\t\t\t\t\t<span class="{{if(ifEquals(criteriaArray.api_name,concat(module,\'.\',item.api_name)),\'selectedTick\',\'\')}}"></span>\t\t\t\t\t\t\t\t\t\t\t    {{item.field_label}}\t\t\t\t\t\t\t\t\t\t\t\t</lyte-drop-item>\t\t\t\t\t\t\t\t\t\t\t</template>\t\t\t\t\t\t\t\t\t\t\t<template is="if" value="{{emptyFieldShow}}"><template case="true">\t\t\t\t\t\t\t\t\t\t\t\t<lyte-drop-item class="prevent">{{ cruxGetI18n("crm.label.no.options.found") }}</lyte-drop-item>\t\t\t\t\t\t\t\t\t\t\t</template></template>\t\t\t\t\t\t\t\t\t\t</lyte-drop-body>\t\t\t\t\t\t\t\t\t</lyte-drop-box>\t\t\t\t\t\t\t\t</template>\t\t\t\t\t\t\t</lyte-dropdown>\t\t\t\t\t\t</div>\t\t\t\t\t</div>              </lyte-td>                <lyte-td>       \t\t\t\t<div class="patternNumDiv" style="height: auto; opacity: 1; overflow: visible;">               \t\t<div class="dropdownDiv shown" id="nonecondition">                  \t\t\t<lyte-dropdown class="gBB" lt-prop-yield="true" lt-prop-tabindex="1" id="textcondition" lt-prop-disabled="true" on-option-selected="{{method(\'changeCondition\')}}">\t\t\t\t\t\t\t<template is="registerYield" yield-name="yield">\t\t\t\t\t\t\t\t<lyte-drop-box>\t\t\t\t\t\t\t\t\t<lyte-drop-body>\t\t\t\t\t\t\t\t\t\t<lyte-drop-item data-value="0" value="none">{{cruxGetI18n("None")}}\t\t\t\t\t\t\t\t\t\t</lyte-drop-item>\t\t\t\t\t\t\t\t\t</lyte-drop-body>\t\t\t\t\t\t\t\t</lyte-drop-box>\t\t\t\t\t\t\t</template>\t\t\t\t\t\t</lyte-dropdown>                  \t\t</div>                  \t\t<div class="dropdownDiv hiden" id="conditionDiv">                  \t\t\t<lyte-dropdown class="gBB" lt-prop-yield="true" lt-prop-tabindex="1" id="comparator" on-option-selected="{{method(\'changeCondition\')}}" on-show="{{method(\'onConditionDropdownShow\')}}">\t\t\t\t\t\t\t<template is="registerYield" yield-name="yield">\t\t\t\t\t\t\t\t<lyte-drop-box>\t\t\t\t\t\t\t\t\t<template is="if" value="{{expHandlers(condArray.length,\'>\',9)}}"><template case="true">\t\t\t\t\t\t\t\t\t\t\t<lyte-drop-header>\t\t\t\t\t\t\t\t \t\t\t\t<lyte-search id="conditionSearchBox" onfocus="{{action(\'onFocusFieldSearch\', event, this)}}" onfocusout="{{action(\'onFocusOutFieldSearch\', event, this)}}" class="conditionSearchStyle{{criteriaIndex}}" lt-prop-style="padding-left:8px" lt-prop-placeholder="{{cruxGetI18n(\'crm.globalsearch.search.title\')}}" lt-prop-query-selector="{&quot;scope&quot;:&quot;.lyteConditionDropbody{{criteriaIndex}}&quot;,&quot;search&quot;:&quot;lyte-drop-item:not(.prevent)&quot;, &quot;target&quot; : &quot;lyte-drop-item:not(.prevent)&quot;}" style="width:100%" on-search="{{method(&quot;onConditionSearch&quot;)}}" lt-prop-appearance="box"> \t\t\t\t\t\t\t\t\t\t\t\t</lyte-search> \t\t\t\t\t\t\t\t\t\t\t</lyte-drop-header>\t\t\t\t\t\t\t\t\t\t</template></template>\t\t\t\t\t\t\t\t\t<lyte-drop-body class="lyteConditionDropbody{{criteriaIndex}}">\t\t\t\t\t\t\t\t\t\t<template is="for" items="{{condArray}}" item="item" index="index">\t\t\t\t\t\t\t\t\t\t<lyte-drop-item data-value="{{index}}" value="{{item.system}}">\t\t\t\t\t\t\t\t\t\t\t<span class="{{if(ifEquals(criteriaArray.comparator,item.system)),\'selectedTick\',\'\')}}"></span>\t\t\t\t\t\t\t\t\t\t\t{{item.display}}\t\t\t\t\t\t\t\t\t\t</lyte-drop-item>\t\t\t\t\t\t\t\t\t\t</template>\t\t\t\t\t\t\t\t\t\t<template is="if" value="{{emptyConditionShow}}"><template case="true">\t\t\t\t\t\t\t\t\t\t\t\t<lyte-drop-item class="prevent">{{ cruxGetI18n("crm.label.no.options.found") }}</lyte-drop-item>\t\t\t\t\t\t\t\t\t\t\t</template></template>\t\t\t\t\t\t\t\t\t</lyte-drop-body>\t\t\t\t\t\t\t\t</lyte-drop-box>\t\t\t\t\t\t\t</template>\t\t\t\t\t\t</lyte-dropdown>                  \t\t</div>                  \t</div>                </lyte-td>                <lyte-td>            \t\t            \t\t<div id="searchval_div" class="pR">            \t\t\t<template is="if" value="{{noneCondition}}"><template case="true">\t\t\t\t\t\t\t<lyte-input class="gBB disabledText" lt-prop-type="text" lt-prop-disabled="true" lt-prop-value="{{disableText}}"> </lyte-input>            \t\t\t</template><template case="false"><template is="if" value="{{ageInDaysCond}}"><template case="true">\t\t\t\t\t\t\t\t<lyte-td style="width:25%">\t\t                \t\t\t<lyte-dropdown on-option-selected="{{method(\'changeAgeInDaysCondition\')}}" class="gBB" lt-prop-yield="true" lt-prop-tabindex="1" id="ageindayscondition">\t\t\t\t\t\t\t\t\t<template is="registerYield" yield-name="yield">\t\t\t\t\t\t\t\t\t\t<lyte-drop-box>\t\t\t\t\t\t\t\t\t\t\t<lyte-drop-body>\t\t\t\t\t\t\t\t\t\t\t\t<template is="for" items="{{ageindays}}" item="item" index="index">\t\t\t\t\t\t\t\t\t\t\t\t\t<lyte-drop-item data-value="{{index}}" value="{{item.system}}">{{item.display}}</lyte-drop-item>\t\t\t\t\t\t\t\t\t\t\t\t</template>\t\t\t\t\t\t\t\t\t\t\t</lyte-drop-body>\t\t\t\t\t\t\t\t\t\t</lyte-drop-box>\t\t\t\t\t\t\t\t\t</template>\t\t\t\t\t\t\t\t\t</lyte-dropdown>\t\t\t\t\t\t\t\t</lyte-td>\t\t\t\t\t\t\t\t<lyte-td style="width:75%">\t\t\t\t\t\t\t\t\t<crux-number-component id="ageValueInput" cx-prop-from="criteria"></crux-number-component>\t\t\t\t\t\t\t\t</lyte-td>\t            \t\t\t</template><template case="false"><template is="if" value="{{betweenCond}}"><template case="true">\t\t\t\t\t\t\t\t\t<template is="component" id="betweenComponent1" component-name="crux-{{elementsCond}}-component" cx-prop-from="criteria" cx-prop-date-pattern="{{getUserDetail(\'DATE_PATTERN\')}}"></template>\t\t\t\t\t\t\t\t\t<template is="component" id="betweenComponent2" component-name="crux-{{elementsCond}}-component" cx-prop-from="criteria" cx-prop-date-pattern="{{getUserDetail(\'DATE_PATTERN\')}}"></template>\t            \t\t\t\t</template><template case="false">\t\t\t\t\t\t\t\t\t<template is="component" id="elementComponent" component-name="crux-{{elementsCond}}-component" cx-prop-from="criteria" cx-prop-module="{{module}}" cx-prop-date-pattern="{{getUserDetail(\'DATE_PATTERN\')}}" cx-prop-field="{{selectedField}}"></template>\t            \t\t\t\t</template></template></template></template></template></template>            \t\t</div>                 </lyte-td>                 <lyte-td class="addRemove">        \t\t\t<div class="patternNumDiv" style="height: auto; opacity: 1; overflow: visible;">        \t\t\t\t<template is="if" value="{{showRemove}}"><template case="true">         \t\t\t\t<a id="check1" class="removeCriteria" onclick="{{action(\'removeCriteria\')}}"></a>         \t\t\t\t</template></template><template is="if" value="{{showAdd}}"><template case="true">         \t\t\t\t<a id="addRow" class="addCriteria" onclick="{{action(\'createNewCriteria\')}}"></a>         \t\t\t\t</template></template>         \t\t\t</div>                 </lyte-td>                 </div></template>',_dynamicNodes:[{type:"attr",position:[0,0,1,1]},{type:"if",position:[0,0,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]}]}},default:{}},{type:"attr",position:[0,0,1,5]},{type:"componentDynamic",position:[0,0]},{type:"attr",position:[0,2,1,1,1]},{type:"registerYield",position:[0,2,1,1,1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,3]},{type:"attr",position:[1,3,1]},{type:"attr",position:[1,3,1,1]},{type:"text",position:[1,3,1,3]},{type:"componentDynamic",position:[1,3,1]},{type:"attr",position:[1,3,3]},{type:"for",position:[1,3,3],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"text",position:[1,3]},{type:"componentDynamic",position:[1]}]},{type:"attr",position:[1,3,5]},{type:"if",position:[1,3,5],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"componentDynamic",position:[1,3]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[0,2,1,1,1]},{type:"componentDynamic",position:[0,2]},{type:"attr",position:[0,4,1,1,1]},{type:"registerYield",position:[0,4,1,1,1,1],dynamicNodes:[{type:"text",position:[1,1,1,0]},{type:"componentDynamic",position:[1,1,1]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[0,4,1,1,1]},{type:"attr",position:[0,4,1,3,1]},{type:"registerYield",position:[0,4,1,3,1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,3]},{type:"attr",position:[1,3,1]},{type:"for",position:[1,3,1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"text",position:[1,3]},{type:"componentDynamic",position:[1]}]},{type:"attr",position:[1,3,3]},{type:"if",position:[1,3,3],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"componentDynamic",position:[1,3]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[0,4,1,3,1]},{type:"componentDynamic",position:[0,4]},{type:"attr",position:[0,6,1,1]},{type:"if",position:[0,6,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"registerYield",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"for",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]},{type:"componentDynamic",position:[3,1]},{type:"componentDynamic",position:[3]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"component",position:[1],dynamicNodes:[]},{type:"attr",position:[3]},{type:"component",position:[3],dynamicNodes:[]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"component",position:[1],dynamicNodes:[]}]}},default:{}}]}},default:{}}]}},default:{}},{type:"componentDynamic",position:[0,6]},{type:"attr",position:[0,8,1,1]},{type:"if",position:[0,8,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}},{type:"attr",position:[0,8,1,2]},{type:"if",position:[0,8,1,2],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}},{type:"componentDynamic",position:[0,8]}],_observedAttributes:["module","fields","ageindays","criteria","showAdd","showRemove","selectCond","formCond","criteriaIndex","andOrCondition","ageindays","selectUser","ageInDays","dueInDays","users","dropdowndata","pickList","lookup","renderItems","criteriaObject","setCriteriaObj","tags","layout","emptyFieldShow","emptyPicklistShow","searchValue","showEmpty","condArray","dataType","callModule","lookupField","betweenCond","elementsCond","noneCondition","ageInDaysCond","disableText","removePattern"],data:function(){return{module:Lyte.attr("string"),fields:Lyte.attr("array"),ageindays:Lyte.attr("array"),criteria:Lyte.attr("number"),showAdd:Lyte.attr("boolean"),showRemove:Lyte.attr("boolean"),selectCond:Lyte.attr("string"),formCond:Lyte.attr("string"),criteriaIndex:Lyte.attr("number"),andOrCondition:Lyte.attr("string"),ageindays:Lyte.attr("array"),selectUser:Lyte.attr("boolean",{default:!1}),ageInDays:Lyte.attr("boolean",{default:!1}),dueInDays:Lyte.attr("boolean",{default:!1}),users:Lyte.attr("array"),dropdowndata:Lyte.attr("array"),pickList:Lyte.attr("boolean"),lookup:Lyte.attr("boolean"),renderItems:Lyte.attr("array",{default:[]}),criteriaObject:Lyte.attr("object"),setCriteriaObj:Lyte.attr("object"),tags:Lyte.attr("array"),layout:Lyte.attr("array"),emptyFieldShow:Lyte.attr("boolean",{default:!1}),emptyPicklistShow:Lyte.attr("boolean",{default:!1}),searchValue:Lyte.attr("string"),showEmpty:Lyte.attr("boolean",{default:!1}),condArray:Lyte.attr("array"),dataType:Lyte.attr("string",{default:""}),callModule:Lyte.attr("string",{default:""}),lookupField:Lyte.attr("string",{default:""}),betweenCond:Lyte.attr("boolean",{default:!1}),elementsCond:Lyte.attr("string"),noneCondition:Lyte.attr("boolean",{default:!0}),ageInDaysCond:Lyte.attr("boolean",{default:!1}),disableText:Lyte.attr("string"),removePattern:Lyte.attr("boolean",{default:!1})}},init:function(){this.initCruxConditions("criteria"),this.setData("ageindays",this.ageInDaysConditions),this.setData("condArray",this.textConditions);var t={api_name:_cruxUtils.getI18n("None"),comparator:null,value:null};this.setData("criteriaObject",t),this.executeMethod("criteriaArrayObjectUpdate",this.getData("criteriaObject"),this.getData("criteriaIndex"))},didConnect:function(){this.getData("setCriteriaObj")&&this.setCriteria(this.getData("setCriteriaObj"))},getValue:function(){var t=this.$node.querySelector("#searchval_div"),e=this.getData("criteriaObject.value");if(this.getData("ageInDaysCond")){var i=t.querySelector("crux-number-component").component.getValue();this.getData("ageInDays")?e="${AGE"+i+"}":this.getData("dueInDays")&&(e="${AGE+"+i+"}")}else this.getData("betweenCond")?e=[t.querySelector("#betweenComponent1").component.getValue(),t.querySelector("#betweenComponent2").component.getValue()]:this.getData("noneCondition")||(e=t.querySelector("#elementComponent").component.getValue());this.setData("criteriaObject.value",e),this.executeMethod("criteriaArrayObjectUpdate",this.getData("criteriaObject"),this.getData("criteriaIndex"))},setCriteria:function(t){var e,i,a=t.api_name,r=t.comparator,o=t.value,n=this.$node,s=this.$node.querySelector("lyte-drop-item.selector"+this.getData("criteriaIndex")+'[value="'+a+'"]').getAttribute("data-value");this.changeFieldFunction(null,s),"string"==typeof o&&o.match(/\{/)&&"date"==this.getData("selectCond")&&(o.match(/AGE\+/)?(e=r,i=o,r="Due in Days",o=o.replace(/\D/g,"")):o.match(/AGE/)&&(e=r,i=o,r="Age in Days",o=o.replace(/\D/g,""))),this.getData("selectCond");var l=n.querySelector("div#conditionDiv").querySelector('lyte-drop-item[value="'+r+'"]').getAttribute("data-value"),c=n.querySelector("#searchval_div");if(this.changeConditionFunction(null,l),this.getData("selectUser")&&(o={ids:o.join(",")}),e){var d=c.querySelector("#ageindayscondition");if(d.ltProp("show"))var p=d.component.childComp.querySelector('lyte-drop-item[value="'+e+'"]');else p=d.querySelector('lyte-drop-item[value="'+e+'"]');s=p.getAttribute("data-value"),d.ltProp("selected",s),this.changeAgeInDaysConditionFunction(null,s)}i&&(this.changeValueFunction(i),c.querySelector("#ageValueInput").cxProp("value",o)),this.getData("betweenCond")?(c.querySelector("#betweenComponent1").cxProp("value",o[0]),c.querySelector("#betweenComponent2").cxProp("value",o[1])):this.getData("noneCondition")||c.querySelector("#elementComponent").cxProp("value",o)},changeConditionFunction:function(t,e){var i=this.getData("selectCond");this.setData("ageInDays",!1);var a=this.getData("condArray"),r=this.$node;r.querySelector("div#conditionDiv").children[0].ltProp("selected",e.toString()),r.querySelector("#searchval_div");var o,n=a[e];o=n.system;var s=null;"text"==i&&0==e||"none"==i?(this.setData("noneCondition",!0),this.setData("disableText","")):"text"==i&&7==e||"number"==i&&8==e||"date"==i&&19==e||"date-time"==i&&19==e||"defWithEmpty"==i&&2==e?(this.setData("noneCondition",!0),this.setData("disableText","$(EMPTY)"),o="equal",s="$(EMPTY)"):"text"==i&&8==e||"number"==i&&9==e||"date"==i&&20==e||"date-time"==i&&19==e||"defWithEmpty"==i&&3==e?(this.setData("noneCondition",!0),this.setData("disableText","$(NOTEMPTY)"),o="equal",s="$(NOTEMPTY)"):"number"==i&&(7==e||6==e)||"date"==i&&(4==e||5==e)?this.setData("betweenCond",!0):"date"==i&&e>=6&&e<=16?(this.setData("noneCondition",!0),this.setData("disableText",n.system),o="equal",s=n.system):"date"!=i||17!=e&&18!=e?this.setData("noneCondition",!1):(this.setData("ageInDaysCond",!0),17==e?this.setData("ageInDays",!0):this.setData("dueInDays",!0)),this.setData("criteriaObject.comparator",o),this.setData("criteriaObject.value",s)},changeValueFunction:function(t){var e=!0;this.getMethods("onBeforeValueChangeCall")&&(e=this.executeMethod("onBeforeValueChangeCall")),e?(this.setData("criteriaObject.value",t),this.executeMethod("onValueChangeCall"),this.executeMethod("criteriaArrayObjectUpdate",this.getData("criteriaObject"),this.getData("criteriaIndex"))):this.setCriteria(this.getData("criteriaObject"))},changeFieldFunction:function(t,e){this.setData("renderItems",[]),this.setData("showEmpty",!1),this.setData("selectUser",!1),this.setData("pickList",!1),this.setData("lookup",!1);var i,a=this.$node,r=a.querySelector("lyte-dropdown.fields");r.ltProp("selected",e);var o=(i=r.ltProp("show")?r.component.childComp.querySelector("lyte-drop-item.selector"+this.getData("criteriaIndex")+'[data-value="'+e+'"]'):a.querySelector("lyte-drop-item.selector"+this.getData("criteriaIndex")+'[data-value="'+e+'"]')).id;this.setData("dataType",o);var n,s=i.getAttribute("value");switch(this.getData("criteriaObject"),this.setData("criteriaObject.api_name",s),o){case"none":n="none",elementsCond="none";break;case"text":case"email":case"phone":case"website":case"textarea":n="text",elementsCond="text",this.setData("selectedField",this.getData("fields")[e]);break;case"currency":case"double":case"integer":case"bigint":n="number",elementsCond="number",this.setData("selectedField",this.getData("fields")[e]);break;case"datetime":n="date",elementsCond="date-time";break;case"date":n="date",elementsCond="date";break;case"boolean":n="boolean",elementsCond="boolean";break;case"ownerlookup":n="default",elementsCond="user",this.setData("selectUser",!0);break;case"picklist":this.setData("pickList",!0),n="text",elementsCond="picklist",this.setData("selectedField",this.getData("fields")[e]);break;case"lookup":n="text",elementsCond="text"}s.match(/Tag/)&&(n="defWithEmpty",elementsCond="tag",this.setData("showEmpty",!0)),s.match(/Layout/)&&(n="default",elementsCond="layout",this.setData("showEmpty",!0));var l=n+"Conditions";if(this.setData("condArray",this[l]),this.setData("noneCondition",!0),this.setData("betweenCond",!1),this.setData("ageInDaysCond",!1),this.setData("selectCond",n),this.setData("elementsCond",elementsCond),(c=a.querySelector("div.shown"))&&(c.classList.add("hiden"),c.classList.remove("shown")),"none"==n){var c;(c=a.querySelector("div#nonecondition"))&&(c.classList.add("shown"),c.classList.remove("hiden"))}else{var d=a.querySelector("div#conditionDiv");d&&(d.classList.remove("hiden"),d.classList.add("shown"),d.children[0].ltProp("selected","[]"))}this.changeConditionFunction(t,0)},changeAgeInDaysConditionFunction:function(t,e){this.setData("criteriaObject.comparator",this.getData("ageindays")[e].system),this.executeMethod("criteriaArrayObjectUpdate",this.getData("criteriaObject"),this.getData("criteriaIndex"))},methods:{changeField:function(t,e){this.changeFieldFunction(t,e),this.executeMethod("onFieldChangeCall",this.getData("criteriaIndex"),arguments[3].innerText),this.executeMethod("criteriaArrayObjectUpdate",this.getData("criteriaObject"),this.getData("criteriaIndex"))},changeCondition:function(t,e){this.changeConditionFunction(t,e),this.executeMethod("onOperatorChangeCall",this.getData("criteriaIndex"),arguments[3].innerText),this.executeMethod("criteriaArrayObjectUpdate",this.getData("criteriaObject"),this.getData("criteriaIndex"))},onFieldSearch:function(t){0==t.length?this.setData("emptyFieldShow",!0):this.setData("emptyFieldShow",!1)},onConditionSearch:function(t){0==t.length?this.setData("emptyConditionShow",!0):this.setData("emptyConditionShow",!1)},onFieldDropdownShow:function(){var t=this.$node.querySelector("lyte-search.fieldSearchStyle"+this.getData("criteriaIndex"));t&&(t.setValue(""),t.querySelector("input").focus(),this.$node.constructor._actions.onFocusFieldSearch.call(this))},onConditionDropdownShow:function(){var t=this.$node.querySelector("lyte-search.conditionSearchStyle"+this.getData("criteriaIndex"));t&&(t.setValue(""),t.querySelector("input").focus(),this.$node.constructor._actions.onFocusFieldSearch.call(this))},changeAgeInDaysCondition:function(t,e){this.changeAgeInDaysConditionFunction(t,e)}},actions:{createNewCriteria:function(){this.throwEvent("createNewCriteria")},removeCriteria:function(){this.throwEvent("removeCriteria",this.getData("criteriaIndex"))},changeAndOr:function(){this.throwEvent("changeAndOr",this.getData("andOrCondition"),this.getData("criteriaIndex"))},campLookUp:function(){showLookUp("temp_searchcampcv","lyte"+this.getData("criteriaIndex"),"Campaign Name","Campaigns",null,null,null,null,null,null,null,null,"equal")},onFocusFieldSearch:function(){this.$node.querySelector("lyte-search.fieldSearchStyle"+this.getData("criteriaIndex")).setAttribute("style","border-bottom: 1px solid #2d7ad0;")},onFocusOutFieldSearch:function(){this.$node.querySelector("lyte-search.fieldSearchStyle"+this.getData("criteriaIndex")).removeAttribute("style")}}},{mixins:["crux-criteria-conditions"]}),Lyte.Component.register("crux-criteria-editor-view-header",{_template:'<template tag-name="crux-criteria-editor-view-header"><div class="header"><lyte-td style="opacity:1;">       \t\t\t\t<div class="patternNumDiv" style="height: auto; opacity: 1; overflow: visible;">       \t\t\t\t\t<template is="if" value="{{ifNotEquals(criteriaIndex,1)}}"><template case="true">\t\t       \t\t\t\t<div class="andOr" style="opacity: 1; height: auto;">\t\t       \t\t\t\t\t<lyte-input lt-prop-style="color:blue;cursor:pointer; transform:scale(0.75)" lt-prop-readonly="true" lt-prop-value="{{andOrCondition}}"></lyte-input>\t\t       \t\t\t\t</div>\t       \t\t\t\t</template></template>               \t\t\t<input type="hidden" id="match" value="">               \t\t\t<input type="text" id="patternNum" class="patterNum" value="{{criteriaIndex}}" readonly="">               \t\t</div>                </lyte-td>                <lyte-td>       \t\t\t <span class="colorSpan">{{field}}</span>              </lyte-td>                <lyte-td>       \t\t\t\t<span>{{captialize(condition)}}</span>                </lyte-td>                <lyte-td>            \t\t<span class="colorSpan">{{value}}</span>                 </lyte-td>                 <lyte-td>                 </lyte-td>                 </div></template>',_dynamicNodes:[{type:"attr",position:[0,0,1,1]},{type:"if",position:[0,0,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]}]}},default:{}},{type:"attr",position:[0,0,1,5]},{type:"componentDynamic",position:[0,0]},{type:"text",position:[0,2,1,0]},{type:"componentDynamic",position:[0,2]},{type:"text",position:[0,4,1,0]},{type:"componentDynamic",position:[0,4]},{type:"text",position:[0,6,1,0]},{type:"componentDynamic",position:[0,6]},{type:"componentDynamic",position:[0,8]}],_observedAttributes:["criteria","field","condition","value","andOrCondition","module","criteriaIndex","fields","selectedField","selectedCondition","pickList","selectUser","lookup","callModule","lookupField","tagComponent","layoutComponent"],data:function(){return{criteria:Lyte.attr("object"),field:Lyte.attr("string"),condition:Lyte.attr("string"),value:Lyte.attr("string"),andOrCondition:Lyte.attr("string"),module:Lyte.attr("string"),criteriaIndex:Lyte.attr("string"),fields:Lyte.attr("array"),selectedField:Lyte.attr("object"),selectedCondition:Lyte.attr("array"),pickList:Lyte.attr("boolean",{default:!1}),selectUser:Lyte.attr("boolean",{default:!1}),lookup:Lyte.attr("boolean",{default:!1}),callModule:Lyte.attr("boolean",{default:!1}),lookupField:Lyte.attr("boolean",{default:!1}),tagComponent:Lyte.attr("boolean",{default:!1}),layoutComponent:Lyte.attr("boolean",{default:!1})}},init:function(){this.onGetCriteria()},onGetCriteria:function(){this.getData("criteria")&&(this.initCruxConditions("criteria"),this.setViewCriteriaObj(this.getData("criteria")))},setViewCriteriaObj:function(t){var e,i,a=t.api_name,r=t.comparator,o=t.value;this.setData("selectUser",!1),this.setData("pickList",!1),this.setData("lookup",!1),this.setData("tagComponent",!1),this.setData("layoutComponent",!1);for(var n=this.getData("fields"),s=n.length,l=0;l<s;l++)if(n[l].api_name==a){this.setData("selectedField",n[l]),a=n[l].field_label,e=n[l].data_type;break}switch(e){case"none":select="none";break;case"text":case"email":case"phone":case"website":case"textarea":select="text";break;case"currency":case"double":case"integer":case"bigint":select="number";break;case"datetime":select="datetime";break;case"date":select="date";break;case"boolean":select="boolean";break;case"ownerlookup":select="default",this.setData("selectUser",!0);break;case"picklist":this.setData("pickList",!0),select="text",this.setData("selectedFieldPicklist",this.getData("selectedField").pick_list_values);break;case"lookup":select="text",this.setData("lookup",!0);var c=field.lookup.module.api_name;store.findRecord("module",moduleRecordMapping[c].id),this.setData("callModule",c),this.setData("lookupField",field.api_name)}if(a.match(/Tag/)&&(this.setData("tagComponent",!0),select="defWithEmpty",this.setData("showEmpty",!0)),a.match(/Layout/)&&(this.setData("layoutComponent",!0),select="default",this.setData("showEmpty",!0)),"string"==typeof o&&o.match(/AGE/g)){i=r;var d=this.ageInDaysConditions;for(l=0;l<d.length;l++)if(d[l].system==i){i=d[l].display;break}r=(o=i+" "+(o=o.replace(/\D/g,""))).match(/\+/g)?"Due in Days":"Age in Days"}var p=select+"Conditions";this.setData("selectedCondition",this[p]);var y=r;for(l=0;l<this.getData("selectedCondition").length;l++)if(r==this.getData("selectedCondition")[l].system){r=this.getData("selectedCondition")[l].display;break}if("datetime"==select&&(o=Utils.getDateTimeInUsrViewFormat(o)),"date"==select&&(o=Utils.getDateInUsrViewFormat(o)),"boolean"==select&&(o=0==o?_cruxUtils.getI18n("crm.label.notSelected"):_cruxUtils.getI18n("crm.label.selected")),y.match(/between/)&&(o="datetime"==select?Utils.getDateTimeInUsrViewFormat(o[0])+","+Utils.getDateTimeInUsrViewFormat(o[1]):"date"==select?Utils.getDateInUsrViewFormat(o[0])+","+Utils.getDateInUsrViewFormat(o[1]):o[0]+","+o[1]),y.match(/empty/)&&(o="",this.setData("selectUser",!1),this.setData("pickList",!1),this.setData("lookup",!1),this.setData("tagComponent",!1),this.setData("layoutComponent",!1)),this.getData("pickList")&&"object"==typeof o&&(o=o.join(" ,")),this.getData("selectUser")){var u=this;store.findAll("user").then(function(){for(var t=[],e=0;e<o.length;e++)t.push(store.peekRecord("user",o[e]).full_name);o=t.join(","),u.setData("value",o)})}if(this.getData("lookup")&&(o=o.join(",")),this.getData("tagComponent")){var h=store.peekAll("tag").filterBy({modRefId:o[0]})[0].name;for(l=1;l<o.length;l++)h=h+","+store.peekAll("tag").filterBy({modRefId:o[l]})[0].name}this.setData("field",a),this.setData("condition",r),this.setData("value",o)},observeCriteria:function(){this.onGetCriteria()}.observes("criteria")},{mixins:["crux-criteria-conditions"]});